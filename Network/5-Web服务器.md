## Web 服务器

### 通信数据转发的中间站

HTTP 通信时， 除客户端和服务器以外， 还有一些用于通信数据转发的应用程序， 例如**代理**、 **网关**和**隧道**。 它们可以配合服务器工作。

### 代理

- 代理

代理是一种有转发功能的应用程序， 它扮演了位于服务器和客户端“中间人”的角色， 接收由客户端发送的请求并转发给服务器， 同时也接收服务器返回的响应并转发给客户端。

代理有多种使用方法， 按两种基准分类。 一种是是否使用缓存， 另一种是是否会修改报文。

1. 缓存代理

代理转发响应时， 缓存代理（Caching Proxy）会预先将资源的副本（缓存） 保存在代理服务器上。当代理再次接收到对相同资源的请求时， 就可以不从源服务器那里获取资源， 而是将之前缓存的资源作为响应返回。

2. 透明代理

转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理（Transparent Proxy）。 反之，对报文内容进行加工的代理被称为非透明代理。

相关的头部字段：Via、X-Forwarded-For、X-Real-IP

**负载均衡**。客户端的请求只会先到达代理服务器，后面到底有多少源服务器，IP 都是多少，客户端是不知道的。因此，这个代理服务器可以拿到这个请求之后，可以通过特定的算法分发给不同的源服务器，让各台源服务器的负载尽量平均。当然，这样的算法有很多，包括随机算法、轮询、一致性 hash、LRU(最近最少使用)等等。

**保障安全**。利用心跳机制监控后台的服务器，一旦发现故障机就将其踢出集群。并且对于上下行的数据进行过滤，对非法 IP 限流，这些都是代理服务器的工作。

**缓存代理**。将内容缓存到代理服务器，使得客户端可以直接从代理服务器获得而不用到源服务器那里。

### 网关

- 网关

网关是转发其他服务器通信数据的服务器， 接收从客户端发送来的请求时， 它就像自己拥有资源的源服务器一样对请求进行处理。 有时客户端可能都不会察觉，自己的通信目标是一个网关。

网关的工作机制和代理十分相似。 而网关能使通信线路上的服务器提供非 HTTP 协议服务。

利用网关能提高通信的安全性， 因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。

### 隧道

- 隧道

隧道是在相隔甚远的客户端和服务器两者之间进行中转， 并保持双方通信连接的应用程序。

隧道可按要求建立起一条与其他服务器的通信线路， 届时使用 SSL 等加密手段进行通信。 隧道的目的是确保客户端能与服务器进行安全的通信。

隧道本身不会去解析 HTTP 请求。 也就是说， 请求保持原样中转给之后的服务器。 隧道会在通信双方断开连接时结束。

### 缓存

- 缓存

缓存是指代理服务器或客户端本地磁盘内保存的资源副本。 利用缓存可减少对源服务器的访问， 因此也就节省了通信流量和通信时间。

即使存在缓存， 也会因为客户端的要求、 缓存的有效期等因素， 向源服务器确认资源的有效性。 若判断缓存失效， 缓存服务器将会再次从源服务器上获取“新”资源。

缓存不仅可以存在于缓存服务器内， 还可以存在客户端浏览器中。 以 Internet Explorer 程序为例， 把客户端缓存称为临时网络文件（ Temporary Internet File） 。
