# Vue3çš„templateç¼–è¯‘

ç›®çš„æ˜¯å°†å¼€å‘è€…å†™çš„`template`ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°`render`ï¼Œæ¸²æŸ“å‡½æ•°`render`ç„¶åè¿›ä¸€æ­¥è§£æä¸ºè™šæ‹ŸDOMã€‚

`template -> AST -> transform -> generate -> æ¸²æŸ“å‡½æ•°ï¼ˆrenderï¼‰-> VNode`

`Vue3` æä¾›äº†ä¸€ä¸ª`template`åœ¨çº¿ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°`render`çš„ç½‘ç«™å¦‚ä¸‹ï¼š

[Vue 3 Template Explorer](https://template-explorer.vuejs.org/#eyJzcmMiOiI8ZGl2PkhlbGxvIFdvcmxkPC9kaXY+Iiwib3B0aW9ucyI6e319)

## ç¼–è¯‘å…¥å£(æµè§ˆå™¨ç«¯)

ä¹‹å‰åˆ†æç»„ä»¶åŒ–çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªæ­¥éª¤è°ƒç”¨`setupComponent`åˆå§‹åŒ–ç»„ä»¶ä¸­æœ€åä¼šè°ƒç”¨`finishComponentSetup`æ–¹æ³•ï¼Œå…¶ä¸­æœ‰è¿™æ ·ä¸€æ®µï¼Œå¦‚æœç»„ä»¶å®ä¾‹`instance`ä¸Šæ²¡æœ‰`render`æ–¹æ³•é‚£å°±ç”Ÿæˆ`render`æ–¹æ³•å¹¶æŒ‚è½½åˆ°è¿™ä¸ªç»„ä»¶å®ä¾‹`instance`çš„`render`å±æ€§ä¸Šï¼Œåœ¨åç»­ç»„ä»¶æ„é€ çš„è¿‡ç¨‹ä¸­è°ƒç”¨`renderComponentRoot`æ–¹æ³•ä¼šè°ƒç”¨ç”Ÿæˆçš„`render`æ–¹æ³•æ„å»ºè™šæ‹Ÿ`Node`æ ‘ã€‚

è¿™ä¸ª`render`æ–¹æ³•å…¶å®æ˜¯ç”±`compile`æ–¹æ³•ç”Ÿæˆï¼š

```ts
// template / render function normalization
  // could be already set when returned from setup()
  if (!instance.render) {
    // only do on-the-fly compile if not in SSR - SSR on-the-fly compilation
    // is done by server-renderer
    if (!isSSR && compile && !Component.render) {
      const template =
        (__COMPAT__ &&
          instance.vnode.props &&
          instance.vnode.props['inline-template']) ||
        Component.template ||
        resolveMergedOptions(instance).template
      if (template) {
        // ...
        const { isCustomElement, compilerOptions } = instance.appContext.config
        const { delimiters, compilerOptions: componentCompilerOptions } =
          Component
        const finalCompilerOptions: CompilerOptions = extend(
          extend(
            {
              isCustomElement,
              delimiters
            },
            compilerOptions
          ),
          componentCompilerOptions
        )
        // ...
        // ã€æœ¬è´¨æ˜¯è°ƒç”¨äº†compileToFunctionæ–¹æ³•ï¼Œä¼ å…¥å¼€å‘è€…å†™çš„templateå’Œç¼–è¯‘ç›¸å…³çš„é…ç½®ã€‘
        Component.render = compile(template, finalCompilerOptions)
        // ...
      }
    }

    instance.render = (Component.render || NOOP) as InternalRenderFunction

    // for runtime-compiled render functions using `with` blocks, the render
    // proxy used needs a different `has` handler which is more performant and
    // also only allows a whitelist of globals to fallthrough.
    if (installWithProxy) {
      installWithProxy(instance)
    }
  }
```

å…¶ä¸­ä¸€ä¸ªå…³é”®çš„æ­¥éª¤ï¼Œ`compile`æ–¹æ³•ç”±`registerRuntimeCompiler`æ–¹æ³•æ³¨å†Œè¿”å›ï¼š

```ts
// ã€packages/runtime-core/src/component.tsã€‘
// ã€finishComponentSetupã€‘
Component.render = compile(template, finalCompilerOptions)
instance.render = (Component.render || NOOP) as InternalRenderFunction

//ã€compileæ–¹æ³•ç”±registerRuntimeCompileræ–¹æ³•è¿”å›ã€‘
let compile: CompileFunction | undefined
let installWithProxy: (i: ComponentInternalInstance) => void

/**
 * For runtime-dom to register the compiler.
 * Note the exported method uses any to avoid d.ts relying on the compiler types.
 */
export function registerRuntimeCompiler(_compile: any) {
  compile = _compile
  installWithProxy = i => {
    if (i.render!._rc) {
      i.withProxy = new Proxy(i.ctx, RuntimeCompiledPublicInstanceProxyHandlers)
    }
  }
}

// ã€packages/vue/src/index.tsã€‘
registerRuntimeCompiler(compileToFunction)
```

è¿™ä¸ª`compile`æ–¹æ³•ä½•æ—¶ç”±`registerRuntimeCompiler`æ–¹æ³•æ³¨å†Œå‘¢ï¼Œå¯ä»¥çœ‹`packages/vue/src/index.ts`ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å°†`compileToFunction(template,options)`æ–¹æ³•ä¼ å…¥`registerRuntimeCompiler`æ–¹æ³•ï¼Œç»„ä»¶å®ä¾‹ä¸Šçš„`render`æ–¹æ³•å…¶å®å°±æ˜¯`compile`æ–¹æ³•ï¼Œè€Œ`compile`æ–¹æ³•å…¶å®å°±æ˜¯è¿™ä¸ª`compileToFunction`æ–¹æ³•ã€‚

ç»“è®ºï¼Œ`compile`æ–¹æ³•æœ¬è´¨æ˜¯è°ƒç”¨äº†`compileToFunction`æ–¹æ³•ï¼Œä¼ å…¥å¼€å‘è€…å†™çš„`template`å’Œç¼–è¯‘ç›¸å…³çš„é…ç½®å¦‚ä¸‹ï¼š

```ts
// ã€packages/vue/src/index.tsã€‘
import { compile, CompilerOptions, CompilerError } from '@vue/compiler-dom'
//ã€ç¼–è¯‘è¿‡çš„templateä¼šè¿›è¡Œç¼“å­˜ã€‘
const compileCache: Record<string, RenderFunction> = Object.create(null)

function compileToFunction(
  template: string | HTMLElement,
  options?: CompilerOptions
): RenderFunction {
  //ã€templateä¸æ˜¯stringåˆ™è·å–innerHTMLå†…å®¹ã€‘
  if (!isString(template)) {
    if (template.nodeType) {
      template = template.innerHTML
    } else {
      __DEV__ && warn(`invalid template option: `, template)
      return NOOP
    }
  }
  //ã€æ£€æŸ¥ç¼“å­˜çœ‹æ˜¯å¦å·²ç»ç¼–è¯‘è¿‡ã€‘
  const key = template
  const cached = compileCache[key]
  if (cached) {
    return cached
  }
  //ã€templateé¦–å­—ç¬¦æ˜¯#å½“æˆDOMé€‰æ‹©å™¨è·å–DOMå†…å®¹ã€‘
  if (template[0] === '#') {
    const el = document.querySelector(template)
    if (__DEV__ && !el) {
      warn(`Template element not found or is empty: ${template}`)
    }
    // __UNSAFE__
    // Reason: potential execution of JS expressions in in-DOM template.
    // The user must make sure the in-DOM template is trusted. If it's rendered
    // by the server, the template should not contain any user data.
    template = el ? el.innerHTML : ``
  }
  //ã€åˆå¹¶ç¼–è¯‘çš„é€‰é¡¹ã€‘
  const opts = extend(
    {
      hoistStatic: true,
      onError: __DEV__ ? onError : undefined,
      onWarn: __DEV__ ? e => onError(e, true) : NOOP
    } as CompilerOptions,
    options
  )

  if (!opts.isCustomElement && typeof customElements !== 'undefined') {
    opts.isCustomElement = tag => !!customElements.get(tag)
  }

  //ã€æ ¸å¿ƒï¼šé€šè¿‡compileæ–¹æ³•è·å–codeã€‘
  const { code } = compile(template, opts)

  function onError(err: CompilerError, asWarning = false) {
    const message = asWarning
      ? err.message
      : `Template compilation error: ${err.message}`
    const codeFrame =
      err.loc &&
      generateCodeFrame(
        template as string,
        err.loc.start.offset,
        err.loc.end.offset
      )
    warn(codeFrame ? `${message}\n${codeFrame}` : message)
  }

  //ã€codeç”Ÿæˆrenderæ–¹æ³•ã€‘
  // The wildcard import results in a huge object with every export
  // with keys that cannot be mangled, and can be quite heavy size-wise.
  // In the global build we know `Vue` is available globally so we can avoid
  // the wildcard object.
  const render = (
    __GLOBAL__ ? new Function(code)() : new Function('Vue', code)(runtimeDom)
  ) as RenderFunction

  // mark the function as runtime compiled
  ;(render as InternalRenderFunction)._rc = true

  //ã€ç¼–è¯‘å®Œæˆåå°†renderæ–¹æ³•ç¼“å­˜ä¸‹æ¥å¹¶è¿”å›ã€‘
  return (compileCache[key] = render)
}
//ã€æ³¨å†Œcompileæ–¹æ³•ã€‘
registerRuntimeCompiler(compileToFunction)
```

æ‰€ä»¥åœ¨ç»„ä»¶ç”Ÿæˆå¯¹åº”`render`æ–¹æ³•æ„æˆ`VNode`è¿‡ç¨‹ä¸­æœ€ç»ˆè°ƒç”¨çš„æ˜¯`packages/vue/src/index.ts`çš„`compileToFunction`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿›è¡Œä¸€äº›è·å–`template`å®é™…å†…å®¹ã€æ£€æŸ¥ç¼“å­˜ã€å‚æ•°åˆå¹¶ã€`code`åŒ…è£…æˆ`render`å‡½æ•°ã€æœ€ç»ˆè¿”å›`render`å‡½æ•°ç­‰æ“ä½œã€‚å¯ä»¥çœ‹åˆ°`compileToFunction`æ–¹æ³•çš„æ ¸å¿ƒæ˜¯`packages/compiler-dom/src/index.ts`ä¸­`const { code } = compile(template, opts)`çš„`compile`æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ¢ç©¶`compile`æ–¹æ³•ã€‚

## compile => 1.parse 2.transform 3.generate

`compile` æ–¹æ³•è¾“å…¥æ˜¯`template`å’Œ`options`ï¼Œ`template`æ˜¯ç”¨æˆ·ç¼–å†™çš„æ¨¡æ¿ä»£ç ï¼Œ`options`æ˜¯è§£ææŒ‡ä»¤ä»¥åŠæ–¹æ³•çš„å‡½æ•°é€‰é¡¹ï¼Œæœ€ç»ˆè¾“å‡ºæ˜¯ä¸€æ®µå¯æ‰§è¡Œ`code`ï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªå…³é”®æ­¥éª¤ï¼š

1. `parse`æ–¹æ³•ç”Ÿæˆ`AST`æ ‘
2. `transform`æ–¹æ³•å¯¹`AST`æ ‘è¿›è¡Œè½¬æ¢ä¼˜åŒ–
3. `generate`æ–¹æ³•ç”Ÿæˆå¯æ‰§è¡Œçš„ä»£ç 

```ts
// ã€packages/compiler-dom/src/index.tsã€‘
export function compile(
  template: string,
  options: CompilerOptions = {}
): CodegenResult {
  //ã€é‡è½½è°ƒç”¨baseCompileã€‘
  return baseCompile(
    template,
    extend({}, parserOptions, options, {
      nodeTransforms: [
        // ignore <script> and <tag>
        // this is not put inside DOMNodeTransforms because that list is used
        // by compiler-ssr to generate vnode fallback branches
        ignoreSideEffectTags,
        ...DOMNodeTransforms,
        ...(options.nodeTransforms || [])
      ],
      directiveTransforms: extend(
        {},
        DOMDirectiveTransforms,
        options.directiveTransforms || {}
      ),
      transformHoist: __BROWSER__ ? null : stringifyStatic
    })
  )
}

// ã€packages/compiler-core/src/compile.tsã€‘
export function baseCompile(
  template: string | RootNode,
  options: CompilerOptions = {}
): CodegenResult {
  const onError = options.onError || defaultOnError
  const isModuleMode = options.mode === 'module'
  /* istanbul ignore if */
  if (__BROWSER__) {
    if (options.prefixIdentifiers === true) {
      onError(createCompilerError(ErrorCodes.X_PREFIX_ID_NOT_SUPPORTED))
    } else if (isModuleMode) {
      onError(createCompilerError(ErrorCodes.X_MODULE_MODE_NOT_SUPPORTED))
    }
  }

  const prefixIdentifiers =
    !__BROWSER__ && (options.prefixIdentifiers === true || isModuleMode)
  if (!prefixIdentifiers && options.cacheHandlers) {
    onError(createCompilerError(ErrorCodes.X_CACHE_HANDLER_NOT_SUPPORTED))
  }
  if (options.scopeId && !isModuleMode) {
    onError(createCompilerError(ErrorCodes.X_SCOPE_ID_NOT_SUPPORTED))
  }
  //ã€ç¬¬ä¸€æ­¥ï¼šparse-templateé€šè¿‡parseæ–¹æ³•è½¬åŒ–ä¸ºastæ ‘ã€‘
  const ast = isString(template) ? baseParse(template, options) : template  
  const [nodeTransforms, directiveTransforms] =
    getBaseTransformPreset(prefixIdentifiers)

  if (!__BROWSER__ && options.isTS) {
    const { expressionPlugins } = options
    if (!expressionPlugins || !expressionPlugins.includes('typescript')) {
      options.expressionPlugins = [...(expressionPlugins || []), 'typescript']
    }
  }

  //ã€ç¬¬äºŒæ­¥ï¼štransform-astæ ‘ç»è¿‡transformæ–¹æ³•ä¼˜åŒ–ã€‘
  transform(
    ast,
    extend({}, options, {
      prefixIdentifiers,
      nodeTransforms: [
        ...nodeTransforms,
        ...(options.nodeTransforms || []) // user transforms
      ],
      directiveTransforms: extend(
        {},
        directiveTransforms,
        options.directiveTransforms || {} // user transforms
      )
    })
  )

  //ã€ç¬¬ä¸‰æ­¥ï¼šcodeGen-generateæ–¹æ³•ç”Ÿæˆå¯æ‰§è¡Œcodeã€‘
  return generate(
    ast,
    extend({}, options, {
      prefixIdentifiers
    })
  )
}
```

`compile`æ–¹æ³•åœ¨`packages/compiler-dom/src/index.ts`æ–‡ä»¶ä¸­ï¼Œå› ä¸º`compile`æ–¹æ³•å…¶å®æ˜¯å¹³å°ç›¸å…³çš„ï¼Œæˆ‘ä»¬åˆ†æçš„æ˜¯åœ¨æµè§ˆå™¨ä¸­ã€‚é™¤æ­¤ä¹‹å¤–ä»£ç çš„ç»„ç»‡è¿˜ç”¨åˆ°äº†å‡½æ•°æŸ¯ç†åŒ–çš„æŠ€å·§ï¼ŒæŠŠåŸºç¡€çš„ç¼–è¯‘è¿‡ç¨‹å‡½æ•°æŠ½å‡ºæ¥ï¼Œé€šè¿‡ `registerRuntimeCompiler(compileToFunction)` çš„æ–¹å¼æŠŠçœŸæ­£ç¼–è¯‘çš„è¿‡ç¨‹å’Œå…¶å®ƒé€»è¾‘å¦‚å¯¹ç¼–è¯‘é…ç½®å¤„ç†ã€ç¼“å­˜å¤„ç†ç­‰å‰¥ç¦»å¼€ï¼Œè¿™æ ·çš„è®¾è®¡è¿˜æ˜¯éå¸¸å·§å¦™çš„ã€‚

åæ–‡ä¸­åˆ†æçš„ç”¨ä¾‹å¦‚ä¸‹ï¼š

```ts
<script src="../../dist/vue.global.js"></script>

<div id="demo">
  <div v-for="{ commit } in commits" :key="commit">
    <span :id="commit.author">{{ commit.author.name }}</span>
    ---
    <span>{{ commit.author.date }}</span>
  </div>
  <div style="color: red">{{currentBranchPlus}}</div>
  <div style="color: aquamarine" @click="clickToChangeBranch()">
    click me!{{reactiveObj.name}}
  </div>
</div>

<script>
  const {
    ref,
    reactive,
    computed,
    watchEffect,
    onBeforeMount,
    onMounted,
    onBeforeUpdate,
    onUpdated
  } = Vue
  const API_URL = `https://api.github.com/repos/vuejs/core/commits?per_page=2&sha=`

  Vue.createApp({
    setup() {
      const currentBranch = ref('main')
      const commits = ref(null)
      const currentBranchPlus = computed(
        () => `Im on which branch: ${currentBranch.value}`
      )
      const reactiveObj = reactive({
        name: 'reactiveObj',
        extraProperty: 'extraProperty'
      })

      // onBeforeMount(() => {
      //   console.log('ğŸ¥’ ~ file: test.html:26 ~ onBeforeMount ~ onBeforeMount:')
      // })
      onMounted(() => {
        console.log('ğŸ¥’ ~ file: test.html:22 ~ onMounted ~ onMounted')
        reactiveObj.name = 'newReactiveObj'
      })
      // onBeforeUpdate(() => {
      //   console.log('ğŸ¥’ ~ file: test.html:22 ~ onBeforeUpdate ~ onBeforeUpdate')
      // })
      // onUpdated(() => {
      //   console.log('ğŸ¥’ ~ file: test.html:26 ~ onUpdated ~ onUpdated:')
      // })

      watchEffect(() => {
        fetch(`${API_URL}${currentBranch.value}`)
          .then(res => res.json())
          .then(data => {
            commits.value = data
            console.log(
              'ğŸ¥’ ~ file: test.html:55 ~ watchEffect ~ commits.value:',
              commits.value
            )
          })
      })

      clickToChangeBranch = e => {
        currentBranch.value = ''
        console.log('its click', e)
      }

      return {
        currentBranch,
        currentBranchPlus,
        commits,
        reactiveObj,
        clickToChangeBranch
      }
    }
  }).mount('#demo')
</script>
```

## parse

```ts
// ã€packages/compiler-core/src/compile.tsã€‘
const ast = isString(template) ? baseParse(template, options) : template  
```

- `parse` ä¸»è¦æ˜¯å°† `template` è½¬æˆ `AST`ã€‚`AST`æ˜¯ä¸€ç§æŠ½è±¡è¯­æ³•æ ‘ï¼Œæ˜¯å¯¹æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç°å½¢å¼ï¼Œæœ€ç»ˆçš„`AST`æ ‘åº”è¯¥æ˜¯ä»¥ç±»ä¼¼å¦‚ä¸‹æ•°æ®ç»“æ„çš„å¯¹è±¡ï¼š

```ts
{
  type: 0,
  children,
  helpers: [],
  components: [],
  directives: [],
  hoists: [],
  imports: [],
  cached: 0,
  temps: 0,
  codegenNode: undefined,
  loc
}
```

é¦–å…ˆè°ƒç”¨`baseParse`å¦‚ä¸‹ï¼Œ`extend({}, parserOptions, options)` å°† `parserOptions` å’Œ `options` åˆå¹¶ï¼Œ`export const extend = Object.assign`ï¼Œ`extend`å…¶å®å°±æ˜¯`Object.assign`æ–¹æ³•ï¼Œ`parserOptions` æ˜¯å¹³å°ç›¸å…³çš„è§£æé€‰é¡¹ï¼Œ`options` åˆ™æ˜¯ç”¨æˆ·å¯é€‰æ‹©çš„è§£æé€‰é¡¹ã€‚

`baseParse`é¦–å…ˆåˆ›é€ ä¸€ä¸ª`parse`è¿‡ç¨‹çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨`parse`è¿‡ç¨‹ä¸­ç›¸å…³çš„ä¸€äº›çŠ¶æ€å’Œæ“ä½œï¼Œä¾‹å¦‚æºä»£ç å­—ç¬¦ä¸²ã€å¤„ç†åˆ°ç¬¬å‡ è¡Œç¬¬å‡ åˆ—ç­‰ç­‰ã€‚ç„¶åä¼šè¿›å…¥æ ¸å¿ƒè½¬åŒ–è¿‡ç¨‹`parseChildren`æ–¹æ³•ã€‚

```ts
// ã€packages/compiler-core/src/parse.tsã€‘
export function parse(template: string, options: ParserOptions = {}): RootNode {
  return baseParse(template, extend({}, parserOptions, options))
}

export function baseParse(
  content: string,
  options: ParserOptions = {}
): RootNode {
  const context = createParserContext(content, options)
  const start = getCursor(context)
  return createRoot(
    parseChildren(context, TextModes.DATA, []),//ã€è§£æå­èŠ‚ç‚¹ã€‘
    getSelection(context, start)//ã€è·å–èµ·å§‹ç»ˆç‚¹ä½ç½®ï¼Œç¬¬å‡ è¡Œç¬¬å‡ åˆ—ã€‘
  )
}
// ã€ä¸ºè¿™ä¸ªç»„ä»¶å…ˆå»ºä¸€ä¸ªç©ºçš„æ ¹èŠ‚ç‚¹ã€‘
export function createRoot(
  children: TemplateChildNode[],
  loc = locStub
): RootNode {
  return {
    type: NodeTypes.ROOT,
    children,
    helpers: [],
    components: [],
    directives: [],
    hoists: [],
    imports: [],
    cached: 0,
    temps: 0,
    codegenNode: undefined,
    loc
  }
}

function getSelection(
  context: ParserContext,
  start: Position,
  end?: Position
): SourceLocation {
  end = end || getCursor(context)
  return {
    start,
    end,
    source: context.originalSource.slice(start.offset, end.offset)
  }
}
```

ç„¶åç»§ç»­çœ‹æ ¸å¿ƒæ–¹æ³•`parseChildren`ï¼Œéå†`context.source`ä¹Ÿå°±æ˜¯æºä»£ç ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è§£æå­—ç¬¦ä¸²ï¼š

- å¦‚æœä»¥ `{{` å¼€å§‹ï¼Œå½“æˆæ’å€¼è§£æï¼Œè°ƒç”¨ `parseInterpolation` æ–¹æ³•
- å¦‚æœä»¥ `<` å¼€å§‹
  - å­—ç¬¦ä¸²é•¿åº¦ä¸º1ï¼ŒæŠ¥é”™
  - å­—ç¬¦ä¸²ä»¥`<!`å¼€å¤´
    - å­—ç¬¦ä¸²ä»¥`<!--`å¼€å¤´ï¼Œè°ƒç”¨ `parseComment` æ–¹æ³•
    - å­—ç¬¦ä¸²ä»¥`<!DOCTYPE`å¼€å¤´ï¼Œè°ƒç”¨ `parseBogusComment` æ–¹æ³•
    - å­—ç¬¦ä¸²ä»¥`<![CDATA[`å¼€å¤´ï¼Œåˆåˆ†äº†ä¸‰ç§æƒ…å†µåˆ†æ
  - æ¥ä¸‹æ¥æ˜¯ `/` å­—ç¬¦
    - å­—ç¬¦ä¸²é•¿åº¦ä¸º2ï¼ŒæŠ¥é”™
    - æ¥ä¸‹æ¥æ˜¯ `>` å­—ç¬¦ï¼ŒæŠ¥é”™
    - å¦‚æœæ˜¯`a-z`çš„å­—æ¯ï¼Œè°ƒç”¨ `parseTag` æ–¹æ³•
    - å¦åˆ™æŠ¥é”™
  - æ¥ä¸‹æ¥æ˜¯`a-z`çš„å­—æ¯ï¼Œè°ƒç”¨ `parseElement` æ–¹æ³•
  - æ¥æ¥æ˜¯`?`ï¼ŒæŠ¥é”™
  - å¦åˆ™ï¼Œå…¶ä»–æƒ…å†µéƒ½æŠ¥é”™å¤„ç†
- è§£æå‡ºæ¥çš„`node`èŠ‚ç‚¹è‹¥ä¸å­˜åœ¨ï¼Œè°ƒç”¨ `parseText` æ–¹æ³•å½“åšæ–‡æœ¬å¤„ç†
- å°†ä¸€ä¸ªä¸ª`node`å…¨éƒ¨æ¨å…¥`nodes`æ•°ç»„ï¼Œè¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ä¼šçœ‹å‰åä¸¤ä¸ª`node`æ˜¯å¦éƒ½æ˜¯æ–‡æœ¬ç±»å‹ï¼Œå¦‚æœæ˜¯çš„è¯ä¼šåˆå¹¶ï¼Œé’ˆå¯¹æ–‡æœ¬æ˜¯`a>b`ç±»ä¼¼æƒ…å†µ
- å¤„ç†ç©ºç™½
- æœ€ç»ˆè¿”å›è§£æç»“æœ

```ts
// ã€packages/compiler-core/src/parse.tsã€‘
export const enum TextModes {
  //          | Elements | Entities | End sign              | Inside of
  DATA, //    | âœ”        | âœ”        | End tags of ancestors |
  RCDATA, //  | âœ˜        | âœ”        | End tag of the parent | <textarea>
  RAWTEXT, // | âœ˜        | âœ˜        | End tag of the parent | <style>,<script>
  CDATA,
  ATTRIBUTE_VALUE
}
//ã€ç¼–è¯‘å‡ºé”™è°ƒç”¨æ­¤æ–¹æ³•ã€‘
function emitError(
  context: ParserContext,
  code: ErrorCodes,
  offset?: number,
  loc: Position = getCursor(context)
): void {
  if (offset) {
    loc.offset += offset
    loc.column += offset
  }
  context.options.onError(
    createCompilerError(code, {
      start: loc,
      end: loc,
      source: ''
    })
  )
}

function parseChildren(
  context: ParserContext,
  mode: TextModes,
  ancestors: ElementNode[]
): TemplateChildNode[] {
  const parent = last(ancestors)
  const ns = parent ? parent.ns : Namespaces.HTML
  const nodes: TemplateChildNode[] = []

  while (!isEnd(context, mode, ancestors)) {
    __TEST__ && assert(context.source.length > 0)
    const s = context.source
    let node: TemplateChildNode | TemplateChildNode[] | undefined = undefined

    if (mode === TextModes.DATA || mode === TextModes.RCDATA) {
      if (!context.inVPre && startsWith(s, context.options.delimiters[0])) {
        //ã€s[0]æ˜¯{{ã€‘
        // '{{'
        node = parseInterpolation(context, mode)
      } else if (mode === TextModes.DATA && s[0] === '<') {
        //ã€s[0]æ˜¯'<'ï¼Œs[1]ååˆèµ°å‘'!'ã€'/'ã€/[a-z]/i.test(s[1])ã€'?'å‡ ä¸ªå¯èƒ½åˆ†æ”¯ã€‘
        // https://html.spec.whatwg.org/multipage/parsing.html#tag-open-state
        if (s.length === 1) {
          emitError(context, ErrorCodes.EOF_BEFORE_TAG_NAME, 1)
        } else if (s[1] === '!') {
          // https://html.spec.whatwg.org/multipage/parsing.html#markup-declaration-open-state
          if (startsWith(s, '<!--')) {
            node = parseComment(context)
          } else if (startsWith(s, '<!DOCTYPE')) {
            // Ignore DOCTYPE by a limitation.
            node = parseBogusComment(context)
          } else if (startsWith(s, '<![CDATA[')) {
            if (ns !== Namespaces.HTML) {
              node = parseCDATA(context, ancestors)
            } else {
              emitError(context, ErrorCodes.CDATA_IN_HTML_CONTENT)
              node = parseBogusComment(context)
            }
          } else {
            emitError(context, ErrorCodes.INCORRECTLY_OPENED_COMMENT)
            node = parseBogusComment(context)
          }
        } else if (s[1] === '/') {
          // https://html.spec.whatwg.org/multipage/parsing.html#end-tag-open-state
          if (s.length === 2) {
            emitError(context, ErrorCodes.EOF_BEFORE_TAG_NAME, 2)
          } else if (s[2] === '>') {
            emitError(context, ErrorCodes.MISSING_END_TAG_NAME, 2)
            advanceBy(context, 3)
            continue
          } else if (/[a-z]/i.test(s[2])) {
            emitError(context, ErrorCodes.X_INVALID_END_TAG)
            parseTag(context, TagType.End, parent)
            continue
          } else {
            emitError(
              context,
              ErrorCodes.INVALID_FIRST_CHARACTER_OF_TAG_NAME,
              2
            )
            node = parseBogusComment(context)
          }
        } else if (/[a-z]/i.test(s[1])) {
          node = parseElement(context, ancestors)

          // 2.x <template> with no directive compat
          if (
            __COMPAT__ &&
            isCompatEnabled(
              CompilerDeprecationTypes.COMPILER_NATIVE_TEMPLATE,
              context
            ) &&
            node &&
            node.tag === 'template' &&
            !node.props.some(
              p =>
                p.type === NodeTypes.DIRECTIVE &&
                isSpecialTemplateDirective(p.name)
            )
          ) {
            __DEV__ &&
              warnDeprecation(
                CompilerDeprecationTypes.COMPILER_NATIVE_TEMPLATE,
                context,
                node.loc
              )
            node = node.children
          }
        } else if (s[1] === '?') {
          emitError(
            context,
            ErrorCodes.UNEXPECTED_QUESTION_MARK_INSTEAD_OF_TAG_NAME,
            1
          )
          node = parseBogusComment(context)
        } else {
          emitError(context, ErrorCodes.INVALID_FIRST_CHARACTER_OF_TAG_NAME, 1)
        }
      }
    }
    if (!node) {
      node = parseText(context, mode)
    }

    if (isArray(node)) {
      for (let i = 0; i < node.length; i++) {
        pushNode(nodes, node[i])
      }
    } else {
      pushNode(nodes, node)
    }
  }

  // Whitespace handling strategy like v2
  let removedWhitespace = false
  if (mode !== TextModes.RAWTEXT && mode !== TextModes.RCDATA) {
    const shouldCondense = context.options.whitespace !== 'preserve'
    for (let i = 0; i < nodes.length; i++) {
      const node = nodes[i]
      if (node.type === NodeTypes.TEXT) {
        if (!context.inPre) {
          if (!/[^\t\r\n\f ]/.test(node.content)) {
            const prev = nodes[i - 1]
            const next = nodes[i + 1]
            // Remove if:
            // - the whitespace is the first or last node, or:
            // - (condense mode) the whitespace is adjacent to a comment, or:
            // - (condense mode) the whitespace is between two elements AND contains newline
            if (
              !prev ||
              !next ||
              (shouldCondense &&
                (prev.type === NodeTypes.COMMENT ||
                  next.type === NodeTypes.COMMENT ||
                  (prev.type === NodeTypes.ELEMENT &&
                    next.type === NodeTypes.ELEMENT &&
                    /[\r\n]/.test(node.content))))
            ) {
              removedWhitespace = true
              nodes[i] = null as any
            } else {
              // Otherwise, the whitespace is condensed into a single space
              node.content = ' '
            }
          } else if (shouldCondense) {
            // in condense mode, consecutive whitespaces in text are condensed
            // down to a single space.
            node.content = node.content.replace(/[\t\r\n\f ]+/g, ' ')
          }
        } else {
          // #6410 normalize windows newlines in <pre>:
          // in SSR, browsers normalize server-rendered \r\n into a single \n
          // in the DOM
          node.content = node.content.replace(/\r\n/g, '\n')
        }
      }
      // Remove comment nodes if desired by configuration.
      else if (node.type === NodeTypes.COMMENT && !context.options.comments) {
        removedWhitespace = true
        nodes[i] = null as any
      }
    }
    if (context.inPre && parent && context.options.isPreTag(parent.tag)) {
      // remove leading newline per html spec
      // https://html.spec.whatwg.org/multipage/grouping-content.html#the-pre-element
      const first = nodes[0]
      if (first && first.type === NodeTypes.TEXT) {
        first.content = first.content.replace(/^\r?\n/, '')
      }
    }
  }

  return removedWhitespace ? nodes.filter(Boolean) : nodes
}
```

åœ¨è§£æ`template`çš„æ—¶å€™ï¼ŒæŠŠ`template`å½“æˆå­—ç¬¦ä¸²ï¼Œé€æ­¥è§£æï¼Œå¯ä»¥çœ‹åˆ°`advanceBy`å‡½æ•°ï¼Œå°†è§£æå®Œçš„éƒ¨åˆ†é€æ¸ä»`template`å­—ç¬¦ä¸²ä¸­å‰¥ç¦»ã€‚ç„¶åæ ¹æ®æ­£åˆ™åŒ¹é…ï¼Œä¸åŒçš„ç±»å‹èŠ‚ç‚¹è¿›è¡Œä¸åŒæ–¹æ³•çš„å¤„ç†ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªå®Œæ•´çš„ASTæ ‘ï¼Œæ‰€è°“çš„ä¸åŒç±»å‹æœ‰å¦‚ä¸‹ç­‰ï¼š

- å…ƒç´ èŠ‚ç‚¹
- å±æ€§èŠ‚ç‚¹
- æŒ‡ä»¤èŠ‚ç‚¹
- æ–‡æœ¬èŠ‚ç‚¹
- å·®å€¼èŠ‚ç‚¹
- æ³¨é‡ŠèŠ‚ç‚¹

ç»“æŸ`parse`è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª`template`è§£æå®Œæ¯•ç”Ÿæˆçš„å®Œæ•´çš„`ast`æ ‘ï¼Œç„¶åè¿›å…¥`transform`çš„æ­¥éª¤ã€‚

![compile](./assets/ast1.png)
![compile](./assets/ast2.png)
![compile](./assets/ast3.png)

ç»è¿‡ç¬¬ä¸€æ­¥parseåç”¨ä¾‹ç”Ÿæˆçš„astæ ‘å¦‚ä¸‹ï¼š

![compile](./assets/ast4.png)

## transform

```ts
// ã€packages/compiler-core/src/compile.tsã€‘
transform(
  ast,
  extend({}, options, {
    prefixIdentifiers,
    nodeTransforms: [
      ...nodeTransforms,
      ...(options.nodeTransforms || []) // user transforms
    ],
    directiveTransforms: extend(
      {},
      directiveTransforms,
      options.directiveTransforms || {} // user transforms
    )
  })
)

// nodeTransforms
[
  transformOnce,
  transformIf,
  transformMemo,
  transformFor,
  ...(__COMPAT__ ? [transformFilter] : []),
  ...(!__BROWSER__ && prefixIdentifiers
    ? [
        // order is important
        trackVForSlotScopes,
        transformExpression
      ]
    : __BROWSER__ && __DEV__
    ? [transformExpression]
    : []),
  transformSlotOutlet,
  transformElement,
  trackSlotScopes,
  transformText
]
// directiveTransforms
{
  on: transformOn,
  bind: transformBind,
  model: transformModel
}
```

- `transform`ä¸»è¦é€šè¿‡`transform`æ–¹æ³•å°† `AST` è¿›è¡Œä¼˜åŒ–è½¬æ¢ï¼Œå¹¶ç¡®å®š`patchFlag`ç”¨äºåç»­èŠ‚ç‚¹å˜åŒ–patchæ–¹æ³•ä¸­çš„ä¼˜åŒ–ç­‰ã€‚å…¶ä¸­è½¬åŒ–çš„æ“ä½œåˆ†ä¸ºä¸¤ç±»`nodeTransforms`å’Œ`directiveTransforms`ã€‚

`transform`ä¸­å‡ ä¸ªå…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š

1. `createTransformContext`åˆ›å»º`transform`å·¥ä½œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒåŒ…å«å½“å‰æ­£åœ¨å¤„ç†çš„èŠ‚ç‚¹`currentNode`ã€`ast`æ ‘ä¿¡æ¯ã€ä¸€ç³»åˆ—å¤„ç†æ–¹æ³•`nodeTransforms`ç­‰ç­‰
2. `traverseNode`éå†`ast`æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œç„¶åéå†è°ƒç”¨`nodeTransforms`æ–¹æ³•ä¼˜åŒ–`ast`èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ç”Ÿæˆ`codegenNode`å±æ€§
3. `hoistStatic`æ ¹æ®å‚æ•°æ˜¯å¦è¿›è¡Œé™æ€å˜é‡æå‡
4. `createRootCodegen`ä¸ºæ ¹èŠ‚ç‚¹ç”Ÿæˆ`codegenNode`å±æ€§

```ts
// ã€packages/compiler-core/src/transform.tsã€‘
export function transform(root: RootNode, options: TransformOptions) {
  //ã€ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºtransformä¸Šä¸‹æ–‡ã€‘
  const context = createTransformContext(root, options)
  //ã€ç¬¬äºŒæ­¥ï¼šéå†astèŠ‚ç‚¹ã€‘
  traverseNode(root, context)
  //ã€ç¬¬ä¸‰æ­¥ï¼šé™æ€æå‡ã€‘
  if (options.hoistStatic) {
    hoistStatic(root, context)
  }
  //ã€ç¬¬å››éƒ¨ï¼šä¸ºæ ¹èŠ‚ç‚¹ç”ŸæˆcodegenNodeå±æ€§ã€‘
  if (!options.ssr) {
    createRootCodegen(root, context)
  }
  // finalize meta information
  // ã€å°†åç»­æ‰€æœ‰ä¼šç”¨åˆ°çš„è¾…åŠ©å‡½æ•°ã€ç»„ä»¶ã€æŒ‡ä»¤ã€é™æ€å†…å®¹ç­‰ç­‰ä¿¡æ¯æ”¾ç½®åœ¨rootçš„å±æ€§ä¸Šã€‘
  root.helpers = [...context.helpers.keys()]
  root.components = [...context.components]
  root.directives = [...context.directives]
  root.imports = context.imports
  root.hoists = context.hoists
  root.temps = context.temps
  root.cached = context.cached

  if (__COMPAT__) {
    root.filters = [...context.filters!]
  }
}

// ã€éå†astæ ‘ï¼Œç”¨nodeTransformsæ–¹æ³•å»æ”¹é€ ä¼˜åŒ–nodeã€‘
export function traverseNode(
  node: RootNode | TemplateChildNode,
  context: TransformContext
) {
  context.currentNode = node
  // apply transform plugins
  const { nodeTransforms } = context
  const exitFns = []
  for (let i = 0; i < nodeTransforms.length; i++) {
    const onExit = nodeTransforms[i](node, context)
    if (onExit) {
      if (isArray(onExit)) {
        exitFns.push(...onExit)
      } else {
        exitFns.push(onExit)
      }
    }
    if (!context.currentNode) {
      // node was removed
      return
    } else {
      // node may have been replaced
      node = context.currentNode
    }
  }

  switch (node.type) {
    case NodeTypes.COMMENT:
      if (!context.ssr) {
        // inject import for the Comment symbol, which is needed for creating
        // comment nodes with `createVNode`
        context.helper(CREATE_COMMENT)
      }
      break
    case NodeTypes.INTERPOLATION:
      // no need to traverse, but we need to inject toString helper
      if (!context.ssr) {
        context.helper(TO_DISPLAY_STRING)
      }
      break

    // for container types, further traverse downwards
    case NodeTypes.IF:
      for (let i = 0; i < node.branches.length; i++) {
        traverseNode(node.branches[i], context)
      }
      break
    case NodeTypes.IF_BRANCH:
    case NodeTypes.FOR:
    case NodeTypes.ELEMENT:
    case NodeTypes.ROOT:
      traverseChildren(node, context)
      break
  }

  // exit transforms
  context.currentNode = node
  let i = exitFns.length
  while (i--) {
    exitFns[i]()
  }
}

// ã€packages/compiler-core/src/compile.tsã€‘
export function getBaseTransformPreset(
  prefixIdentifiers?: boolean
): TransformPreset {
  return [
    [
      transformOnce,
      transformIf,
      transformMemo,
      transformFor,
      ...(__COMPAT__ ? [transformFilter] : []),
      ...(!__BROWSER__ && prefixIdentifiers
        ? [
            // order is important
            trackVForSlotScopes,
            transformExpression
          ]
        : __BROWSER__ && __DEV__
        ? [transformExpression]
        : []),
      transformSlotOutlet,
      transformElement,
      trackSlotScopes,
      transformText
    ],
    {
      on: transformOn,
      bind: transformBind,
      model: transformModel
    }
  ]
}
```

### `createTransformContext`

`createTransformContext`æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª`transform`è¿‡ç¨‹çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¼šå­˜å‚¨`transform`è¿‡ç¨‹ä¸­ç›¸å…³çš„ä¸€äº›çŠ¶æ€å’Œæ“ä½œï¼Œæ¯”å¦‚å½“å‰æ­£åœ¨å¤„ç†çš„èŠ‚ç‚¹ï¼Œä¹ŸåŒ…æ‹¬`nodeTransforms`å’Œ`directiveTransforms`æ“ä½œæ–¹æ³•ç”¨äºå¤„ç†èŠ‚ç‚¹ç­‰ç­‰ã€‚

```ts
// ã€packages/compiler-core/src/transform.tsã€‘
export function createTransformContext(
  root: RootNode,
  {
    filename = '',
    prefixIdentifiers = false,
    hoistStatic = false,
    cacheHandlers = false,
    nodeTransforms = [],
    directiveTransforms = {},
    transformHoist = null,
    isBuiltInComponent = NOOP,
    isCustomElement = NOOP,
    expressionPlugins = [],
    scopeId = null,
    slotted = true,
    ssr = false,
    inSSR = false,
    ssrCssVars = ``,
    bindingMetadata = EMPTY_OBJ,
    inline = false,
    isTS = false,
    onError = defaultOnError,
    onWarn = defaultOnWarn,
    compatConfig
  }: TransformOptions
): TransformContext {
  const nameMatch = filename.replace(/\?.*$/, '').match(/([^/\\]+)\.\w+$/)
  const context: TransformContext = {
    // options
    selfName: nameMatch && capitalize(camelize(nameMatch[1])),
    prefixIdentifiers,
    hoistStatic,
    cacheHandlers,
    nodeTransforms,
    directiveTransforms,
    transformHoist,
    isBuiltInComponent,
    isCustomElement,
    expressionPlugins,
    scopeId,
    slotted,
    ssr,
    inSSR,
    ssrCssVars,
    bindingMetadata,
    inline,
    isTS,
    onError,
    onWarn,
    compatConfig,

    // state
    root,
    helpers: new Map(),
    components: new Set(),
    directives: new Set(),
    hoists: [],
    imports: [],
    constantCache: new Map(),
    temps: 0,
    cached: 0,
    identifiers: Object.create(null),
    scopes: {
      vFor: 0,
      vSlot: 0,
      vPre: 0,
      vOnce: 0
    },
    parent: null,
    currentNode: root,
    childIndex: 0,
    inVOnce: false,

    // methods
    helper(name) {
      const count = context.helpers.get(name) || 0
      context.helpers.set(name, count + 1)
      return name
    },
    removeHelper(name) {
      const count = context.helpers.get(name)
      if (count) {
        const currentCount = count - 1
        if (!currentCount) {
          context.helpers.delete(name)
        } else {
          context.helpers.set(name, currentCount)
        }
      }
    },
    helperString(name) {
      return `_${helperNameMap[context.helper(name)]}`
    },
    replaceNode(node) {
      /* istanbul ignore if */
      if (__DEV__) {
        if (!context.currentNode) {
          throw new Error(`Node being replaced is already removed.`)
        }
        if (!context.parent) {
          throw new Error(`Cannot replace root node.`)
        }
      }
      context.parent!.children[context.childIndex] = context.currentNode = node
    },
    removeNode(node) {
      if (__DEV__ && !context.parent) {
        throw new Error(`Cannot remove root node.`)
      }
      const list = context.parent!.children
      const removalIndex = node
        ? list.indexOf(node)
        : context.currentNode
        ? context.childIndex
        : -1
      /* istanbul ignore if */
      if (__DEV__ && removalIndex < 0) {
        throw new Error(`node being removed is not a child of current parent`)
      }
      if (!node || node === context.currentNode) {
        // current node removed
        context.currentNode = null
        context.onNodeRemoved()
      } else {
        // sibling node removed
        if (context.childIndex > removalIndex) {
          context.childIndex--
          context.onNodeRemoved()
        }
      }
      context.parent!.children.splice(removalIndex, 1)
    },
    onNodeRemoved: () => {},
    addIdentifiers(exp) {
      // identifier tracking only happens in non-browser builds.
      if (!__BROWSER__) {
        if (isString(exp)) {
          addId(exp)
        } else if (exp.identifiers) {
          exp.identifiers.forEach(addId)
        } else if (exp.type === NodeTypes.SIMPLE_EXPRESSION) {
          addId(exp.content)
        }
      }
    },
    removeIdentifiers(exp) {
      if (!__BROWSER__) {
        if (isString(exp)) {
          removeId(exp)
        } else if (exp.identifiers) {
          exp.identifiers.forEach(removeId)
        } else if (exp.type === NodeTypes.SIMPLE_EXPRESSION) {
          removeId(exp.content)
        }
      }
    },
    hoist(exp) {
      if (isString(exp)) exp = createSimpleExpression(exp)
      context.hoists.push(exp)
      const identifier = createSimpleExpression(
        `_hoisted_${context.hoists.length}`,
        false,
        exp.loc,
        ConstantTypes.CAN_HOIST
      )
      identifier.hoisted = exp
      return identifier
    },
    cache(exp, isVNode = false) {
      return createCacheExpression(context.cached++, exp, isVNode)
    }
  }

  if (__COMPAT__) {
    context.filters = new Set()
  }

  function addId(id: string) {
    const { identifiers } = context
    if (identifiers[id] === undefined) {
      identifiers[id] = 0
    }
    identifiers[id]!++
  }

  function removeId(id: string) {
    context.identifiers[id]!--
  }

  return context
}
```

![compile](./assets/transform1.png)

### `traverseNode`

`traverseNode`æ–¹æ³•éå†`ast`æ ‘çš„èŠ‚ç‚¹ï¼Œç”¨`nodeTransforms`çš„æ–¹æ³•å»è½¬åŒ–æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”ç¡®å®šç”Ÿæˆä»£ç éœ€è¦çš„è¾…åŠ©å‡½æ•°ã€‚

```ts
// ã€packages/compiler-core/src/transform.tsã€‘
export function traverseNode(
  node: RootNode | TemplateChildNode,
  context: TransformContext
) {
  context.currentNode = node
  // apply transform plugins
  const { nodeTransforms } = context
  const exitFns = []
  //ã€å¯¹èŠ‚ç‚¹è¿›è¡Œtransformå·¥ä½œï¼Œæœ‰çš„èŠ‚ç‚¹å¯èƒ½éœ€è¦ç­‰å¾…å­èŠ‚ç‚¹å¤„ç†å®Œæ¯•ä»¥åå†æ“ä½œä¸€äº›å†…å®¹ï¼Œæ‰€ä»¥æœ‰exitFnsç”¨äºå­˜å‚¨å¤„ç†å®Œå­èŠ‚ç‚¹ä»¥åç»§ç»­å¤„ç†å½“å‰èŠ‚ç‚¹çš„æ“ä½œã€‘
  for (let i = 0; i < nodeTransforms.length; i++) {
    const onExit = nodeTransforms[i](node, context)
    if (onExit) {
      if (isArray(onExit)) {
        exitFns.push(...onExit)
      } else {
        exitFns.push(onExit)
      }
    }
    if (!context.currentNode) {
      // node was removed
      return
    } else {
      // node may have been replaced
      node = context.currentNode
    }
  }

  // ã€æ ¹æ®èŠ‚ç‚¹ç±»å‹æŠŠè¾…åŠ©å‡½æ•°å¯¼å…¥ä¸Šä¸‹æ–‡ï¼Œè¿™äº›è¾…åŠ©å‡½æ•°å°±æ˜¯æœ€ç»ˆç”Ÿæˆä»£ç é‡Œçš„_createElementVNode/_createElementBlock/_createVNode/_renderListç­‰ç­‰ã€‘
  switch (node.type) {
    case NodeTypes.COMMENT:
      if (!context.ssr) {
        // inject import for the Comment symbol, which is needed for creating
        // comment nodes with `createVNode`
        context.helper(CREATE_COMMENT)
      }
      break
    case NodeTypes.INTERPOLATION:
      // no need to traverse, but we need to inject toString helper
      if (!context.ssr) {
        context.helper(TO_DISPLAY_STRING)
      }
      break

    // for container types, further traverse downwards
    case NodeTypes.IF:
      // ã€ifæ ‡ç­¾æŒ‰åˆ†æ”¯æ•°é‡ç»§ç»­traverseå­èŠ‚ç‚¹ã€‘
      for (let i = 0; i < node.branches.length; i++) {
        traverseNode(node.branches[i], context)
      }
      break
    case NodeTypes.IF_BRANCH:
    case NodeTypes.FOR:
    case NodeTypes.ELEMENT:
    case NodeTypes.ROOT:
      // ã€astçš„æ ¹èŠ‚ç‚¹ï¼Œéœ€è¦ç»§ç»­traverseå­èŠ‚ç‚¹ã€‘
      traverseChildren(node, context)
      break
  }

  // exit transforms
  context.currentNode = node
  let i = exitFns.length
  // ã€æŠŠæ‰€æœ‰éœ€è¦æ‰§è¡Œçš„nodeTransformsæ–¹æ³•æ‰§è¡Œæ‰ã€‘
  while (i--) {
    exitFns[i]()
  }
}
```

`nodeTransforms`åŒ…æ‹¬`transformElement`ã€`transformText`ã€`transformIf`ç­‰ç­‰è½¬æ¢å‡½æ•°ã€‚ä¸‹é¢æ¥ç ”ç©¶`transformElement`æ–¹æ³•å¦‚ä½•å¯¹èŠ‚ç‚¹è¿›è¡Œ`transform`ï¼š

1. `shouldUseBlock` ç”¨äºåˆ¤æ–­æ˜¯å¦åœ¨å½“å‰å±‚çº§åˆ’ä¸ºä¸€ä¸ª`block`ï¼Œä»¥ä¸‹å‡ ç§æ˜¯ä¼šæˆä¸º`block`çš„æƒ…å†µ
    1. `props`å¤„ç†è¿‡ç¨‹é‡åˆ°ç”¨æˆ·è‡ªå®šä¹‰æŒ‡ä»¤ä¸”æœ‰å­èŠ‚ç‚¹
    2. åŠ¨æ€ç»‘å®š`key`çš„å…ƒç´ 
    3. `keep-alive`ç»„ä»¶
2. å¤„ç†`props`
3. å¤„ç†`children`
4. ç¡®å®š`patchFlag`
5. è°ƒç”¨`createVNodeCall`æ–¹æ³•ä¸ºèŠ‚ç‚¹ç”Ÿæˆ`codegenNode`å±æ€§å¹¶è¿”å›ï¼Œè¿™ä¸ªå±æ€§ç”¨äºåç»­ç”Ÿæˆå¯æ‰§è¡Œä»£ç ï¼ŒåŒ…å«`tag`/`children`/`patchFlag`/`props`ç­‰ç­‰å±æ€§

```ts
// ã€packages/compiler-core/src/transforms/transformElement.tsã€‘
export const transformElement: NodeTransform = (node, context) => {
  // perform the work on exit, after all child expressions have been
  // processed and merged.
  // ã€å¯ä»¥çœ‹åˆ°è¿”å›äº†ä¸€ä¸ªexitå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦å…ˆç­‰å­èŠ‚ç‚¹å¤„ç†å®Œå†å¤„ç†å…ƒç´ èŠ‚ç‚¹çš„å†…å®¹ã€‘
  return function postTransformElement() {
    node = context.currentNode!

    if (
      !(
        node.type === NodeTypes.ELEMENT &&
        (node.tagType === ElementTypes.ELEMENT ||
          node.tagType === ElementTypes.COMPONENT)
      )
    ) {
      return
    }

    const { tag, props } = node
    const isComponent = node.tagType === ElementTypes.COMPONENT

    // The goal of the transform is to create a codegenNode implementing the
    // VNodeCall interface.
    let vnodeTag = isComponent
      ? resolveComponentType(node as ComponentNode, context)
      : `"${tag}"`

    const isDynamicComponent =
      isObject(vnodeTag) && vnodeTag.callee === RESOLVE_DYNAMIC_COMPONENT

    let vnodeProps: VNodeCall['props']
    let vnodeChildren: VNodeCall['children']
    let vnodePatchFlag: VNodeCall['patchFlag']
    let patchFlag: number = 0
    let vnodeDynamicProps: VNodeCall['dynamicProps']
    let dynamicPropNames: string[] | undefined
    let vnodeDirectives: VNodeCall['directives']

    // ã€shouldUseBlockåˆ¤æ–­æ˜¯å¦åœ¨å½“å‰èŠ‚ç‚¹å±‚çº§å½¢æˆä¸€ä¸ªblockã€‘
    let shouldUseBlock =
      // dynamic component may resolve to plain elements
      isDynamicComponent ||
      vnodeTag === TELEPORT ||
      vnodeTag === SUSPENSE ||
      (!isComponent &&
        // <svg> and <foreignObject> must be forced into blocks so that block
        // updates inside get proper isSVG flag at runtime. (#639, #643)
        // This is technically web-specific, but splitting the logic out of core
        // leads to too much unnecessary complexity.
        (tag === 'svg' || tag === 'foreignObject'))

    // ã€å¤„ç†propsã€‘
    // props
    if (props.length > 0) {
      const propsBuildResult = buildProps(
        node,
        context,
        undefined,
        isComponent,
        isDynamicComponent
      )
      vnodeProps = propsBuildResult.props
      // ã€æ ¹æ®å±æ€§çš„æƒ…å†µç¡®å®šå±æ€§ç›¸å…³çš„patchFlagã€‘
      patchFlag = propsBuildResult.patchFlag
      dynamicPropNames = propsBuildResult.dynamicPropNames
      const directives = propsBuildResult.directives
      vnodeDirectives =
        directives && directives.length
          ? (createArrayExpression(
              directives.map(dir => buildDirectiveArgs(dir, context))
            ) as DirectiveArguments)
          : undefined

      if (propsBuildResult.shouldUseBlock) {
        shouldUseBlock = true
      }
    }

    // ã€å¤„ç†å­èŠ‚ç‚¹ã€‘
    // children
    if (node.children.length > 0) {
      if (vnodeTag === KEEP_ALIVE) {
        // Although a built-in component, we compile KeepAlive with raw children
        // instead of slot functions so that it can be used inside Transition
        // or other Transition-wrapping HOCs.
        // To ensure correct updates with block optimizations, we need to:
        // 1. Force keep-alive into a block. This avoids its children being
        //    collected by a parent block.
        shouldUseBlock = true
        // 2. Force keep-alive to always be updated, since it uses raw children.
        // ã€keep-aliveç»„ä»¶ç¡®å®špatchFlagæœ‰DYNAMIC_SLOTSã€‘
        patchFlag |= PatchFlags.DYNAMIC_SLOTS
        if (__DEV__ && node.children.length > 1) {
          context.onError(
            createCompilerError(ErrorCodes.X_KEEP_ALIVE_INVALID_CHILDREN, {
              start: node.children[0].loc.start,
              end: node.children[node.children.length - 1].loc.end,
              source: ''
            })
          )
        }
      }
      // ã€å¦‚æœæ˜¯ç»„ä»¶çš„å­èŠ‚ç‚¹è¯´æ˜æ˜¯æ’æ§½å†…å®¹ã€‘
      const shouldBuildAsSlots =
        isComponent &&
        // Teleport is not a real component and has dedicated runtime handling
        vnodeTag !== TELEPORT &&
        // explained above.
        vnodeTag !== KEEP_ALIVE

      if (shouldBuildAsSlots) {
        const { slots, hasDynamicSlots } = buildSlots(node, context)
        vnodeChildren = slots
        if (hasDynamicSlots) {
          // ã€ç»„ä»¶ä¸”æœ‰å­èŠ‚ä¸”å¯å˜çš„ç¡®å®špatchFlagæœ‰DYNAMIC_SLOTSã€‘
          patchFlag |= PatchFlags.DYNAMIC_SLOTS
        }
      } else if (node.children.length === 1 && vnodeTag !== TELEPORT) {
        const child = node.children[0]
        const type = child.type
        // check for dynamic text children
        const hasDynamicTextChild =
          type === NodeTypes.INTERPOLATION ||
          type === NodeTypes.COMPOUND_EXPRESSION
        if (
          hasDynamicTextChild &&
          getConstantType(child, context) === ConstantTypes.NOT_CONSTANT
        ) {
          // ã€å­èŠ‚ç‚¹ä»…ä¸€ä¸ªä¸”éæ’å€¼èŠ‚ç‚¹ï¼Œè¯´æ˜æ˜¯æ–‡æœ¬ç¡®å®špatchFlagæœ‰TEXTã€‘
          patchFlag |= PatchFlags.TEXT
        }
        // pass directly if the only child is a text node
        // (plain / interpolation / expression)
        if (hasDynamicTextChild || type === NodeTypes.TEXT) {
          vnodeChildren = child as TemplateTextChildNode
        } else {
          vnodeChildren = node.children
        }
      } else {
        vnodeChildren = node.children
      }
    }

    // ã€æ ¹æ®patchFlagç¡®å®šcodegennodeéœ€è¦çš„patchFlagæ ¼å¼ï¼Œé™¤äº†patchFlagè¿˜æœ‰å¤‡æ³¨ã€‘
    // patchFlag & dynamicPropNames
    if (patchFlag !== 0) {
      if (__DEV__) {
        if (patchFlag < 0) {
          // special flags (negative and mutually exclusive)
          vnodePatchFlag = patchFlag + ` /* ${PatchFlagNames[patchFlag]} */`
        } else {
          // bitwise flags
          const flagNames = Object.keys(PatchFlagNames)
            .map(Number)
            .filter(n => n > 0 && patchFlag & n)
            .map(n => PatchFlagNames[n])
            .join(`, `)
          vnodePatchFlag = patchFlag + ` /* ${flagNames} */`
        }
      } else {
        vnodePatchFlag = String(patchFlag)
      }
      if (dynamicPropNames && dynamicPropNames.length) {
        vnodeDynamicProps = stringifyDynamicPropNames(dynamicPropNames)
      }
    }

    // ã€ç”ŸæˆcodegenNodeä¸ºç¬¬ä¸‰æ­¥ç”Ÿæˆä»£ç åšå‡†å¤‡ã€‘
    node.codegenNode = createVNodeCall(
      context,
      vnodeTag,
      vnodeProps,
      vnodeChildren,
      vnodePatchFlag,
      vnodeDynamicProps,
      vnodeDirectives,
      !!shouldUseBlock,
      false /* disableTracking */,
      isComponent,
      node.loc
    )
  }
}

// ã€æœ€åè¿”å›çš„èŠ‚ç‚¹åŒ…å«äº†patchFlagç­‰ç­‰å¾ˆå¤šç”¨äºç”Ÿæˆcodeä»¥åŠåç»­ä¼˜åŒ–éœ€è¦çš„å±æ€§ã€‘
export function createVNodeCall(
  context: TransformContext | null,
  tag: VNodeCall['tag'],
  props?: VNodeCall['props'],
  children?: VNodeCall['children'],
  patchFlag?: VNodeCall['patchFlag'],
  dynamicProps?: VNodeCall['dynamicProps'],
  directives?: VNodeCall['directives'],
  isBlock: VNodeCall['isBlock'] = false,
  disableTracking: VNodeCall['disableTracking'] = false,
  isComponent: VNodeCall['isComponent'] = false,
  loc = locStub
): VNodeCall {
  if (context) {
    if (isBlock) {
      context.helper(OPEN_BLOCK)
      context.helper(getVNodeBlockHelper(context.inSSR, isComponent))
    } else {
      context.helper(getVNodeHelper(context.inSSR, isComponent))
    }
    if (directives) {
      context.helper(WITH_DIRECTIVES)
    }
  }

  return {
    type: NodeTypes.VNODE_CALL,
    tag,
    props,
    children,
    patchFlag,
    dynamicProps,
    directives,
    isBlock,
    disableTracking,
    isComponent,
    loc
  }
}
```

![compile](./assets/transform2.png)
![compile](./assets/transform3.png)

### `hoistStatic`

`hoistStatic`æ–¹æ³•æ ¹æ®ç¼–è¯‘å‚æ•°é‡Œ`hoistStatic`æ˜¯å¦éœ€è¦é™æ€æå‡è¿›è¡Œæ“ä½œï¼Œå°†å¯ä»¥é™æ€æå‡çš„å†…å®¹éƒ½æå‡ä½œä¸ºé™æ€å˜é‡å­˜åœ¨ã€‚

```ts
// ã€packages/compiler-core/src/transforms/hoistStatic.tsã€‘
export function hoistStatic(root: RootNode, context: TransformContext) {
  walk(
    root,
    context,
    // Root node is unfortunately non-hoistable due to potential parent
    // fallthrough attributes.
    isSingleElementRoot(root, root.children[0])
  )
}

export function isSingleElementRoot(
  root: RootNode,
  child: TemplateChildNode
): child is PlainElementNode | ComponentNode | TemplateNode {
  const { children } = root
  return (
    children.length === 1 &&
    child.type === NodeTypes.ELEMENT &&
    !isSlotOutlet(child)
  )
}

function walk(
  node: ParentNode,
  context: TransformContext,
  doNotHoistNode: boolean = false
) {
  const { children } = node
  const originalCount = children.length
  let hoistedCount = 0

  for (let i = 0; i < children.length; i++) {
    const child = children[i]
    // only plain elements & text calls are eligible for hoisting.
    // ã€æ™®é€šå…ƒç´ èŠ‚ç‚¹&æ–‡æœ¬èŠ‚ç‚¹å¯ä»¥è¢«é™æ€æå‡ã€‘
    if (
      child.type === NodeTypes.ELEMENT &&
      child.tagType === ElementTypes.ELEMENT
    ) {
      const constantType = doNotHoistNode
        ? ConstantTypes.NOT_CONSTANT
        : getConstantType(child, context)
      if (constantType > ConstantTypes.NOT_CONSTANT) {
        if (constantType >= ConstantTypes.CAN_HOIST) {
          ;(child.codegenNode as VNodeCall).patchFlag =
            PatchFlags.HOISTED + (__DEV__ ? ` /* HOISTED */` : ``)
          child.codegenNode = context.hoist(child.codegenNode!)
          hoistedCount++
          continue
        }
      } else {
        // node may contain dynamic children, but its props may be eligible for hoisting.
        // ã€åŠ¨æ€èŠ‚ç‚¹çš„é™æ€å±æ€§å¯ä»¥è¢«é™æ€æå‡ã€‘
        const codegenNode = child.codegenNode!
        if (codegenNode.type === NodeTypes.VNODE_CALL) {
          const flag = getPatchFlag(codegenNode)
          if (
            (!flag ||
              flag === PatchFlags.NEED_PATCH ||
              flag === PatchFlags.TEXT) &&
            getGeneratedPropsConstantType(child, context) >=
              ConstantTypes.CAN_HOIST
          ) {
            const props = getNodeProps(child)
            if (props) {
              codegenNode.props = context.hoist(props)
            }
          }
          if (codegenNode.dynamicProps) {
            codegenNode.dynamicProps = context.hoist(codegenNode.dynamicProps)
          }
        }
      }
    }

    // ã€è¿›ä¸€æ­¥éå†å…ƒç´ èŠ‚ç‚¹ã€v-forèŠ‚ç‚¹ã€v-ifèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¯èƒ½å­˜åœ¨é™æ€èŠ‚ç‚¹ã€‘
    // walk further
    if (child.type === NodeTypes.ELEMENT) {
      const isComponent = child.tagType === ElementTypes.COMPONENT
      if (isComponent) {
        context.scopes.vSlot++
      }
      walk(child, context)
      if (isComponent) {
        context.scopes.vSlot--
      }
    } else if (child.type === NodeTypes.FOR) {
      // Do not hoist v-for single child because it has to be a block
      walk(child, context, child.children.length === 1)
    } else if (child.type === NodeTypes.IF) {
      for (let i = 0; i < child.branches.length; i++) {
        // Do not hoist v-if single child because it has to be a block
        walk(
          child.branches[i],
          context,
          child.branches[i].children.length === 1
        )
      }
    }
  }

  if (hoistedCount && context.transformHoist) {
    context.transformHoist(children, context, node)
  }

  // all children were hoisted - the entire children array is hoistable.
  if (
    hoistedCount &&
    hoistedCount === originalCount &&
    node.type === NodeTypes.ELEMENT &&
    node.tagType === ElementTypes.ELEMENT &&
    node.codegenNode &&
    node.codegenNode.type === NodeTypes.VNODE_CALL &&
    isArray(node.codegenNode.children)
  ) {
    node.codegenNode.children = context.hoist(
      createArrayExpression(node.codegenNode.children)
    )
  }
}
```

### `createRootCodegen`

æ¥ä¸‹æ¥æ¥åˆ°`transform`çš„æœ€åä¸€æ­¥ï¼Œæ­¤æ—¶`ast`æ ‘çš„æ‰€æœ‰å­èŠ‚ç‚¹å¯¹åº”`codegenNode`å·²ç»å‡†å¤‡å®Œæ¯•ï¼Œ`createRootCodegen`æ–¹æ³•ä¸ºæ ¹èŠ‚ç‚¹åˆ›å»ºå¯¹åº”`codegenNode`ã€‚

1. å­èŠ‚ç‚¹æ˜¯å•ä¸ªå…ƒç´ èŠ‚ç‚¹è½¬æ¢æˆ`block`ä½œä¸ºæ ¹èŠ‚ç‚¹çš„`codegenNode`ï¼Œå¦åˆ™ç›´æ¥ç”¨ä½œæ ¹èŠ‚ç‚¹çš„`codegenNode`
2. å­èŠ‚ç‚¹æ˜¯å¤šèŠ‚ç‚¹è½¬æ¢æˆ`fragment block`ä½œä¸ºæ ¹èŠ‚ç‚¹çš„`codegenNode`

```ts
// ã€packages/compiler-core/src/transform.tsã€‘
// ã€ç»™æ ¹èŠ‚ç‚¹ç”ŸæˆcodegenNodeå±æ€§ã€‘
function createRootCodegen(root: RootNode, context: TransformContext) {
  const { helper } = context
  const { children } = root
  // ã€å­èŠ‚ç‚¹å°±ä¸€ä¸ªã€‘
  if (children.length === 1) {
    const child = children[0]
    // if the single child is an element, turn it into a block.
    if (isSingleElementRoot(root, child) && child.codegenNode) {
      // single element root is never hoisted so codegenNode will never be
      // SimpleExpressionNode
      const codegenNode = child.codegenNode
      if (codegenNode.type === NodeTypes.VNODE_CALL) {
        makeBlock(codegenNode, context)
      }
      root.codegenNode = codegenNode
    } else {
      // - single <slot/>, IfNode, ForNode: already blocks.
      // - single text node: always patched.
      // root codegen falls through via genNode()
      root.codegenNode = child
    }
  } else if (children.length > 1) {
    // ã€å¤šä¸ªå­èŠ‚ç‚¹ï¼ŒpatchFlagè®¾ç½®ä¸ºSTABLE_FRAGMENTã€‘
    // root has multiple nodes - return a fragment block.
    let patchFlag = PatchFlags.STABLE_FRAGMENT
    let patchFlagText = PatchFlagNames[PatchFlags.STABLE_FRAGMENT]
    // check if the fragment actually contains a single valid child with
    // the rest being comments
    if (
      __DEV__ &&
      children.filter(c => c.type !== NodeTypes.COMMENT).length === 1
    ) {
      patchFlag |= PatchFlags.DEV_ROOT_FRAGMENT
      patchFlagText += `, ${PatchFlagNames[PatchFlags.DEV_ROOT_FRAGMENT]}`
    }
    root.codegenNode = createVNodeCall(
      context,
      helper(FRAGMENT),
      undefined,
      root.children,
      patchFlag + (__DEV__ ? ` /* ${patchFlagText} */` : ``),
      undefined,
      undefined,
      true,
      undefined,
      false /* isComponent */
    )
  } else {
    // no children = noop. codegen will return null.
  }
}
```

![compile](./assets/transform4.png)

åˆ°æ­¤ï¼Œæ ¹èŠ‚ç‚¹çš„`codegenNode`ä¹Ÿå·²ç”Ÿæˆï¼Œç»è¿‡æ”¹é€ çš„`ast`æ ‘å·²ç»å½¢æˆï¼Œä¸‹ä¸€æ­¥å°±æ˜¯`generate`æ–¹æ³•å°†è¿™æ£µ`ast`æ ‘è½¬åŒ–æˆå¯æ‰§è¡Œä»£ç ä¸²ã€‚

## generate

- `generate`æ–¹æ³•å°† `AST` æ ‘è½¬æ¢æˆå¯æ‰§è¡Œçš„ä»£ç ä¹Ÿå°±æ˜¯åœ¨è¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç çš„å­—ç¬¦ä¸²ã€‚

`generate`ä¸­å‡ ä¸ªå…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š

1. `createCodegenContext`åˆ›å»º`generate`å·¥ä½œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒåŒ…å«ä¸€äº›æ ‡å¿—å˜é‡å’Œç”¨äºä»£ç ç”Ÿæˆçš„æ–¹æ³•ç­‰ï¼Œä¾‹å¦‚`push`å¾€ååŠ å…¥ä»£ç ã€`indent`ç¼©è¿›ã€`deindent`å‡å°‘ç¼©è¿›ã€`newline`æ¢è¡Œç­‰ç­‰ã€‚
2. `genFunctionPreamble`ç”Ÿæˆéœ€è¦å¯¼å…¥çš„è¾…åŠ©å‡½æ•°çš„ä»£ç ç­‰
3. æœ€ç»ˆç”Ÿæˆå®Œæ•´çš„`render`å‡½æ•°ä»£ç ä¸²ï¼Œå¤„ç†æ–­è¡Œç­‰ç­‰ï¼Œç„¶åè°ƒç”¨`genNode`æ–¹æ³•éå†ç”Ÿæˆä»£ç ç‰‡æ®µå¹¶æ‹¼æ¥ï¼Œ`genNode`æ–¹æ³•å†…éƒ¨éå†nodeæ ¹æ®ä¸åŒnodeç±»å‹è°ƒç”¨ä¸åŒç”Ÿæˆä»£ç ä¸²çš„æ–¹æ³•

```ts
// ã€packages/compiler-core/src/codegen.tsã€‘
export function generate(
  ast: RootNode,
  options: CodegenOptions & {
    onContextCreated?: (context: CodegenContext) => void
  } = {}
): CodegenResult {
  // ã€1.åˆ›å»ºgenerateä¸Šä¸‹æ–‡ã€‘
  const context = createCodegenContext(ast, options)
  if (options.onContextCreated) options.onContextCreated(context)
  const {
    mode,
    push,
    prefixIdentifiers,
    indent,
    deindent,
    newline,
    scopeId,
    ssr
  } = context

  // ã€å˜é‡åˆ¤æ–­ï¼Œå¦‚æ˜¯å¦inlineã€æ˜¯å¦æµè§ˆå™¨ç¯å¢ƒã€æ˜¯å¦ssrç”¨ä¸åŒå‡½æ•°åç§°ç­‰ç­‰ã€‘
  const hasHelpers = ast.helpers.length > 0
  const useWithBlock = !prefixIdentifiers && mode !== 'module'
  const genScopeId = !__BROWSER__ && scopeId != null && mode === 'module'
  const isSetupInlined = !__BROWSER__ && !!options.inline

  // ã€ç”Ÿæˆé¢„è®¾ä»£ç ã€‘
  // preambles
  // in setup() inline mode, the preamble is generated in a sub context
  // and returned separately.
  const preambleContext = isSetupInlined
    ? createCodegenContext(ast, options)
    : context
  if (!__BROWSER__ && mode === 'module') {
    genModulePreamble(ast, preambleContext, genScopeId, isSetupInlined)
  } else {
    genFunctionPreamble(ast, preambleContext)
  }

  // ã€ç”Ÿæˆrenderå‡½æ•°ã€‘
  // enter render function
  const functionName = ssr ? `ssrRender` : `render`
  const args = ssr ? ['_ctx', '_push', '_parent', '_attrs'] : ['_ctx', '_cache']
  if (!__BROWSER__ && options.bindingMetadata && !options.inline) {
    // binding optimization args
    args.push('$props', '$setup', '$data', '$options')
  }
  const signature =
    !__BROWSER__ && options.isTS
      ? args.map(arg => `${arg}: any`).join(',')
      : args.join(', ')
  // ã€ä»£ç å¼€å¤´ï¼Œæ ¹æ®æ˜¯å¦inlineï¼Œå†™æˆç®­å¤´å‡½æ•°æˆ–è€…function xxxã€‘
  if (isSetupInlined) {
    push(`(${signature}) => {`)
  } else {
    push(`function ${functionName}(${signature}) {`)
  }
  // ã€ä»£ç ç¼©è¿›ã€‘
  indent()

  // ã€æ˜¯å¦ä½¿ç”¨withè¯­æ³•ã€‘
  if (useWithBlock) {
    push(`with (_ctx) {`)
    indent()
    // function mode const declarations should be inside with block
    // also they should be renamed to avoid collision with user properties
    if (hasHelpers) {
      push(`const { ${ast.helpers.map(aliasHelper).join(', ')} } = _Vue`)
      push(`\n`)
      newline()
    }
  }

  // ã€è‡ªå®šä¹‰ç»„ä»¶ã€‘
  // generate asset resolution statements
  if (ast.components.length) {
    genAssets(ast.components, 'component', context)
    if (ast.directives.length || ast.temps > 0) {
      newline()
    }
  }
  // ã€è‡ªå®šä¹‰æŒ‡ä»¤ã€‘
  if (ast.directives.length) {
    genAssets(ast.directives, 'directive', context)
    if (ast.temps > 0) {
      newline()
    }
  }
  if (__COMPAT__ && ast.filters && ast.filters.length) {
    newline()
    genAssets(ast.filters, 'filter', context)
    newline()
  }
  // ã€ä¸´æ—¶å˜é‡ã€‘
  if (ast.temps > 0) {
    push(`let `)
    for (let i = 0; i < ast.temps; i++) {
      push(`${i > 0 ? `, ` : ``}_temp${i}`)
    }
  }
  if (ast.components.length || ast.directives.length || ast.temps) {
    push(`\n`)
    newline()
  }

  // generate the VNode tree expression
  if (!ssr) {
    push(`return `)
  }
  // ã€æ ¹æ®ä¸Šä¸€æ­¥transformè¿‡åçš„astçš„èŠ‚ç‚¹çš„codegenNodeç”Ÿæˆå¯¹åº”å†…å®¹ã€‘
  if (ast.codegenNode) {
    genNode(ast.codegenNode, context)
  } else {
    push(`null`)
  }

  if (useWithBlock) {
    deindent()
    push(`}`)
  }

  deindent()
  push(`}`)

  return {
    ast,
    code: context.code,
    preamble: isSetupInlined ? preambleContext.code : ``,
    // SourceMapGenerator does have toJSON() method but it's not in the types
    map: context.map ? (context.map as any).toJSON() : undefined
  }
}
```

### createCodegenContext

`createCodegenContext`æ–¹æ³•åˆ›å»ºäº†`generate`è¿‡ç¨‹çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«ä¸€äº›æ ‡å¿—å˜é‡å’Œç”¨äºä»£ç ç”Ÿæˆçš„æ–¹æ³•ç­‰ï¼Œä¾‹å¦‚`push`å¾€`context.code`åŠ ä»£ç ã€`indent`ç¼©è¿›ã€`deindent`å‡å°‘ç¼©è¿›ã€`newline`æ¢è¡Œç­‰ç­‰ã€‚

```ts
// ã€packages/compiler-core/src/codegen.tsã€‘
function createCodegenContext(
  ast: RootNode,
  {
    mode = 'function',
    prefixIdentifiers = mode === 'module',
    sourceMap = false,
    filename = `template.vue.html`,
    scopeId = null,
    optimizeImports = false,
    runtimeGlobalName = `Vue`,
    runtimeModuleName = `vue`,
    ssrRuntimeModuleName = 'vue/server-renderer',
    ssr = false,
    isTS = false,
    inSSR = false
  }: CodegenOptions
): CodegenContext {
  const context: CodegenContext = {
    mode,
    prefixIdentifiers,
    sourceMap,
    filename,
    scopeId,
    optimizeImports,
    runtimeGlobalName,
    runtimeModuleName,
    ssrRuntimeModuleName,
    ssr,
    isTS,
    inSSR,
    source: ast.loc.source,
    code: ``,
    column: 1,
    line: 1,
    offset: 0,
    indentLevel: 0,
    pure: false,
    map: undefined,
    helper(key) {
      return `_${helperNameMap[key]}`
    },
    push(code, node) {
      context.code += code
      if (!__BROWSER__ && context.map) {
        if (node) {
          let name
          if (node.type === NodeTypes.SIMPLE_EXPRESSION && !node.isStatic) {
            const content = node.content.replace(/^_ctx\./, '')
            if (content !== node.content && isSimpleIdentifier(content)) {
              name = content
            }
          }
          addMapping(node.loc.start, name)
        }
        advancePositionWithMutation(context, code)
        if (node && node.loc !== locStub) {
          addMapping(node.loc.end)
        }
      }
    },
    indent() {
      newline(++context.indentLevel)
    },
    deindent(withoutNewLine = false) {
      if (withoutNewLine) {
        --context.indentLevel
      } else {
        newline(--context.indentLevel)
      }
    },
    newline() {
      newline(context.indentLevel)
    }
  }

  function newline(n: number) {
    context.push('\n' + `  `.repeat(n))
  }

  function addMapping(loc: Position, name?: string) {
    context.map!.addMapping({
      name,
      source: context.filename,
      original: {
        line: loc.line,
        column: loc.column - 1 // source-map column is 0 based
      },
      generated: {
        line: context.line,
        column: context.column - 1
      }
    })
  }

  if (!__BROWSER__ && sourceMap) {
    // lazy require source-map implementation, only in non-browser builds
    context.map = new SourceMapGenerator()
    context.map!.setSourceContent(filename, context.source)
  }

  return context
}
```

![compile](./assets/generate1.png)

### genFunctionPreamble

`genFunctionPreamble`æ–¹æ³•ä¸»è¦æ˜¯ç”Ÿæˆéœ€è¦å¯¼å…¥çš„è¾…åŠ©å‡½æ•°çš„ä»£ç ç­‰

```ts
// ã€packages/compiler-core/src/codegen.tsã€‘
function genFunctionPreamble(ast: RootNode, context: CodegenContext) {
  const {
    ssr,
    prefixIdentifiers,
    push,
    newline,
    runtimeModuleName,
    runtimeGlobalName,
    ssrRuntimeModuleName
  } = context
  const VueBinding =
    !__BROWSER__ && ssr
      ? `require(${JSON.stringify(runtimeModuleName)})`
      : runtimeGlobalName
  // Generate const declaration for helpers
  // In prefix mode, we place the const declaration at top so it's done
  // only once; But if we not prefixing, we place the declaration inside the
  // with block so it doesn't incur the `in` check cost for every helper access.
  if (ast.helpers.length > 0) {
    if (!__BROWSER__ && prefixIdentifiers) {
      push(
        `const { ${ast.helpers.map(aliasHelper).join(', ')} } = ${VueBinding}\n`
      )
    } else {
      // "with" mode.
      // save Vue in a separate variable to avoid collision
      push(`const _Vue = ${VueBinding}\n`)
      // in "with" mode, helpers are declared inside the with block to avoid
      // has check cost, but hoists are lifted out of the function - we need
      // to provide the helper here.
      if (ast.hoists.length) {
        const staticHelpers = [
          CREATE_VNODE,
          CREATE_ELEMENT_VNODE,
          CREATE_COMMENT,
          CREATE_TEXT,
          CREATE_STATIC
        ]
          .filter(helper => ast.helpers.includes(helper))
          .map(aliasHelper)
          .join(', ')
        push(`const { ${staticHelpers} } = _Vue\n`)
      }
    }
  }
  // generate variables for ssr helpers
  if (!__BROWSER__ && ast.ssrHelpers && ast.ssrHelpers.length) {
    // ssr guarantees prefixIdentifier: true
    push(
      `const { ${ast.ssrHelpers
        .map(aliasHelper)
        .join(', ')} } = require("${ssrRuntimeModuleName}")\n`
    )
  }
  genHoists(ast.hoists, context)
  newline()
  push(`return `)
}
```

![compile](./assets/generate2.png)

### genNode

`genNode`éå†èŠ‚ç‚¹ç”Ÿæˆå¯¹åº”çš„ä»£ç ï¼Œæ ¹æ®èŠ‚ç‚¹ç±»å‹ä¸åŒè°ƒç”¨ä¸åŒæ–¹æ³•ç”Ÿæˆä¾‹å¦‚ï¼š`genComment`ã€`genText`ç­‰ç­‰ï¼Œæ­¤æ—¶ä¼šç”¨åˆ°ä¹‹å‰å­˜å‚¨çš„è¾…åŠ©å‡½æ•°ç”Ÿæˆä»£ç ä¸²ï¼ŒèŠ‚ç‚¹æ‰€æœ‰ç›¸å…³çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨å¯¹åº”çš„`codegenNode`ä¸­ã€‚

```ts
// ã€packages/compiler-core/src/codegen.tsã€‘
function genNode(node: CodegenNode | symbol | string, context: CodegenContext) {
  if (isString(node)) {
    context.push(node)
    return
  }
  if (isSymbol(node)) {
    context.push(context.helper(node))
    return
  }
  switch (node.type) {
    case NodeTypes.ELEMENT:
    case NodeTypes.IF:
    case NodeTypes.FOR:
      __DEV__ &&
        assert(
          node.codegenNode != null,
          `Codegen node is missing for element/if/for node. ` +
            `Apply appropriate transforms first.`
        )
      genNode(node.codegenNode!, context)
      break
    case NodeTypes.TEXT:
      genText(node, context)
      break
    case NodeTypes.SIMPLE_EXPRESSION:
      genExpression(node, context)
      break
    case NodeTypes.INTERPOLATION:
      genInterpolation(node, context)
      break
    case NodeTypes.TEXT_CALL:
      genNode(node.codegenNode, context)
      break
    case NodeTypes.COMPOUND_EXPRESSION:
      genCompoundExpression(node, context)
      break
    case NodeTypes.COMMENT:
      genComment(node, context)
      break
    case NodeTypes.VNODE_CALL:
      genVNodeCall(node, context)
      break

    case NodeTypes.JS_CALL_EXPRESSION:
      genCallExpression(node, context)
      break
    case NodeTypes.JS_OBJECT_EXPRESSION:
      genObjectExpression(node, context)
      break
    case NodeTypes.JS_ARRAY_EXPRESSION:
      genArrayExpression(node, context)
      break
    case NodeTypes.JS_FUNCTION_EXPRESSION:
      genFunctionExpression(node, context)
      break
    case NodeTypes.JS_CONDITIONAL_EXPRESSION:
      genConditionalExpression(node, context)
      break
    case NodeTypes.JS_CACHE_EXPRESSION:
      genCacheExpression(node, context)
      break
    case NodeTypes.JS_BLOCK_STATEMENT:
      genNodeList(node.body, context, true, false)
      break

    // SSR only types
    case NodeTypes.JS_TEMPLATE_LITERAL:
      !__BROWSER__ && genTemplateLiteral(node, context)
      break
    case NodeTypes.JS_IF_STATEMENT:
      !__BROWSER__ && genIfStatement(node, context)
      break
    case NodeTypes.JS_ASSIGNMENT_EXPRESSION:
      !__BROWSER__ && genAssignmentExpression(node, context)
      break
    case NodeTypes.JS_SEQUENCE_EXPRESSION:
      !__BROWSER__ && genSequenceExpression(node, context)
      break
    case NodeTypes.JS_RETURN_STATEMENT:
      !__BROWSER__ && genReturnStatement(node, context)
      break

    /* istanbul ignore next */
    case NodeTypes.IF_BRANCH:
      // noop
      break
    default:
      if (__DEV__) {
        assert(false, `unhandled codegen node type: ${(node as any).type}`)
        // make sure we exhaust all possible types
        const exhaustiveCheck: never = node
        return exhaustiveCheck
      }
  }
}

function genComment(node: CommentNode, context: CodegenContext) {
  const { push, helper, pure } = context
  if (pure) {
    push(PURE_ANNOTATION)
  }
  push(`${helper(CREATE_COMMENT)}(${JSON.stringify(node.content)})`, node)
}

function genText(
  node: TextNode | SimpleExpressionNode,
  context: CodegenContext
) {
  context.push(JSON.stringify(node.content), node)
}
```

![compile](./assets/generate3.png)
![compile](./assets/generate4.png)
![compile](./assets/generate5.png)
![compile](./assets/generate6.png)

ç”Ÿæˆ`render`å‡½æ•°çš„è¾…åŠ©å‡½æ•°æœ‰å¦‚ä¸‹ï¼š

```ts
export const helperNameMap: Record<symbol, string> = {
  [FRAGMENT]: `Fragment`,
  [TELEPORT]: `Teleport`,
  [SUSPENSE]: `Suspense`,
  [KEEP_ALIVE]: `KeepAlive`,
  [BASE_TRANSITION]: `BaseTransition`,
  [OPEN_BLOCK]: `openBlock`,
  [CREATE_BLOCK]: `createBlock`,
  [CREATE_ELEMENT_BLOCK]: `createElementBlock`,
  [CREATE_VNODE]: `createVNode`,
  [CREATE_ELEMENT_VNODE]: `createElementVNode`,
  [CREATE_COMMENT]: `createCommentVNode`,
  [CREATE_TEXT]: `createTextVNode`,
  [CREATE_STATIC]: `createStaticVNode`,
  [RESOLVE_COMPONENT]: `resolveComponent`,
  [RESOLVE_DYNAMIC_COMPONENT]: `resolveDynamicComponent`,
  [RESOLVE_DIRECTIVE]: `resolveDirective`,
  [RESOLVE_FILTER]: `resolveFilter`,
  [WITH_DIRECTIVES]: `withDirectives`,
  [RENDER_LIST]: `renderList`,
  [RENDER_SLOT]: `renderSlot`,
  [CREATE_SLOTS]: `createSlots`,
  [TO_DISPLAY_STRING]: `toDisplayString`,
  [MERGE_PROPS]: `mergeProps`,
  [NORMALIZE_CLASS]: `normalizeClass`,
  [NORMALIZE_STYLE]: `normalizeStyle`,
  [NORMALIZE_PROPS]: `normalizeProps`,
  [GUARD_REACTIVE_PROPS]: `guardReactiveProps`,
  [TO_HANDLERS]: `toHandlers`,
  [CAMELIZE]: `camelize`,
  [CAPITALIZE]: `capitalize`,
  [TO_HANDLER_KEY]: `toHandlerKey`,
  [SET_BLOCK_TRACKING]: `setBlockTracking`,
  [PUSH_SCOPE_ID]: `pushScopeId`,
  [POP_SCOPE_ID]: `popScopeId`,
  [WITH_CTX]: `withCtx`,
  [UNREF]: `unref`,
  [IS_REF]: `isRef`,
  [WITH_MEMO]: `withMemo`,
  [IS_MEMO_SAME]: `isMemoSame`
}
```

## æ€»ç»“

æ ¹æ®ä¹‹å‰çš„ç”¨ä¾‹ï¼Œç»å†ä¸‰ä¸ªæ­¥éª¤ç”Ÿæˆå†…å®¹åˆ†åˆ«å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ç¼–è¯‘å‡ºçš„`code`ï¼Œå¯ä»¥çœ‹åˆ°éœ€è¦`patch`çš„å‡ ä¸ªåœ°æ–¹éƒ½æœ‰å¯¹åº”çš„`patchFlag`ï¼Œåœ¨åç»­`patch`è¿‡ç¨‹ä¸­æ˜¯éå¸¸é‡è¦çš„ä¼˜åŒ–å‰ç½®æ¡ä»¶ï¼Œè¿˜æœ‰ç»‘å®šçš„äº‹ä»¶ä¼šè¿›è¡Œç¼“å­˜ï¼Œä¸ä¼šæ¯æ¬¡é‡æ–°å£°æ˜ä¸€ä¸ªå‡½æ•°å¼•èµ·å­ç»„ä»¶æ›´æ–°ç­‰é—®é¢˜ã€‚

- ç¬¬ä¸€æ­¥`parse`ç”Ÿæˆastæ ‘

```json
{"type":0,"children":[{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":7,"name":"for","exp":{"type":4,"content":"{ commit } in commits","isStatic":false,"constType":0,"loc":{"start":{"column":15,"line":2,"offset":15},"end":{"column":36,"line":2,"offset":36},"source":"{ commit } in commits"}},"modifiers":[],"loc":{"start":{"column":8,"line":2,"offset":8},"end":{"column":37,"line":2,"offset":37},"source":"v-for=\"{ commit } in commits\""}},{"type":7,"name":"bind","exp":{"type":4,"content":"commit","isStatic":false,"constType":0,"loc":{"start":{"column":44,"line":2,"offset":44},"end":{"column":50,"line":2,"offset":50},"source":"commit"}},"arg":{"type":4,"content":"key","isStatic":true,"constType":3,"loc":{"start":{"column":39,"line":2,"offset":39},"end":{"column":42,"line":2,"offset":42},"source":"key"}},"modifiers":[],"loc":{"start":{"column":38,"line":2,"offset":38},"end":{"column":51,"line":2,"offset":51},"source":":key=\"commit\""}}],"isSelfClosing":false,"children":[{"type":1,"ns":0,"tag":"span","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}},"arg":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"modifiers":[],"loc":{"start":{"column":11,"line":3,"offset":63},"end":{"column":30,"line":3,"offset":82},"source":":id=\"commit.author\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}}],"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"}},{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}},{"type":1,"ns":0,"tag":"span","tagType":0,"props":[],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}}],"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"}}],"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"}},{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":6,"name":"style","value":{"type":2,"content":"color: red","loc":{"start":{"column":14,"line":7,"offset":187},"end":{"column":26,"line":7,"offset":199},"source":"\"color: red\""}},"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"currentBranchPlus","loc":{"start":{"column":29,"line":7,"offset":202},"end":{"column":46,"line":7,"offset":219},"source":"currentBranchPlus"}},"loc":{"start":{"column":27,"line":7,"offset":200},"end":{"column":48,"line":7,"offset":221},"source":"{{currentBranchPlus}}"}}],"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"}},{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":6,"name":"style","value":{"type":2,"content":"color: aquamarine","loc":{"start":{"column":14,"line":8,"offset":241},"end":{"column":33,"line":8,"offset":260},"source":"\"color: aquamarine\""}},"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""}},{"type":7,"name":"on","exp":{"type":4,"content":"clickToChangeBranch()","isStatic":false,"constType":0,"loc":{"start":{"column":42,"line":8,"offset":269},"end":{"column":63,"line":8,"offset":290},"source":"clickToChangeBranch()"}},"arg":{"type":4,"content":"click","isStatic":true,"constType":3,"loc":{"start":{"column":35,"line":8,"offset":262},"end":{"column":40,"line":8,"offset":267},"source":"click"}},"modifiers":[],"loc":{"start":{"column":34,"line":8,"offset":261},"end":{"column":64,"line":8,"offset":291},"source":"@click=\"clickToChangeBranch()\""}}],"isSelfClosing":false,"children":[{"type":2,"content":" click me!","loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"}},{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"reactiveObj.name","loc":{"start":{"column":16,"line":9,"offset":308},"end":{"column":32,"line":9,"offset":324},"source":"reactiveObj.name"}},"loc":{"start":{"column":14,"line":9,"offset":306},"end":{"column":34,"line":9,"offset":326},"source":"{{reactiveObj.name}}"}}],"loc":{"start":{"column":3,"line":8,"offset":230},"end":{"column":9,"line":10,"offset":335},"source":"<div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>"}}],"helpers":[],"components":[],"directives":[],"hoists":[],"imports":[],"cached":0,"temps":0,"loc":{"start":{"column":1,"line":1,"offset":0},"end":{"column":1,"line":11,"offset":336},"source":"\n  <div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>\n  <div style=\"color: red\">{{currentBranchPlus}}</div>\n  <div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>\n"}}
```

- ç¬¬äºŒæ­¥`transform`ä¼˜åŒ–astæ ‘ï¼Œä¸ºåç»­ç”Ÿæˆä»£ç åšå‡†å¤‡

```json
{"type":0,"children":[{"type":11,"loc":{"start":{"column":8,"line":2,"offset":8},"end":{"column":37,"line":2,"offset":37},"source":"v-for=\"{ commit } in commits\""},"source":{"type":4,"loc":{"source":"commits","start":{"column":29,"line":2,"offset":29},"end":{"column":36,"line":2,"offset":36}},"content":"commits","isStatic":false,"constType":0},"valueAlias":{"type":4,"loc":{"source":"{ commit }","start":{"column":15,"line":2,"offset":15},"end":{"column":25,"line":2,"offset":25}},"content":"{ commit }","isStatic":false,"constType":0},"parseResult":{"source":{"type":4,"loc":{"source":"commits","start":{"column":29,"line":2,"offset":29},"end":{"column":36,"line":2,"offset":36}},"content":"commits","isStatic":false,"constType":0},"value":{"type":4,"loc":{"source":"{ commit }","start":{"column":15,"line":2,"offset":15},"end":{"column":25,"line":2,"offset":25}},"content":"{ commit }","isStatic":false,"constType":0}},"children":[{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit","isStatic":false,"constType":0,"loc":{"start":{"column":44,"line":2,"offset":44},"end":{"column":50,"line":2,"offset":50},"source":"commit"}},"arg":{"type":4,"content":"key","isStatic":true,"constType":3,"loc":{"start":{"column":39,"line":2,"offset":39},"end":{"column":42,"line":2,"offset":42},"source":"key"}},"modifiers":[],"loc":{"start":{"column":38,"line":2,"offset":38},"end":{"column":51,"line":2,"offset":51},"source":":key=\"commit\""}}],"isSelfClosing":false,"children":[{"type":1,"ns":0,"tag":"span","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}},"arg":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"modifiers":[],"loc":{"start":{"column":11,"line":3,"offset":63},"end":{"column":30,"line":3,"offset":82},"source":":id=\"commit.author\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}}],"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","props":{"type":15,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"value":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}}}]},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_1","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"id\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"}}},{"type":12,"content":{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}},"loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "},"codegenNode":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}}]}},{"type":1,"ns":0,"tag":"span","tagType":0,"props":[],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}}],"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"}}}],"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"},"codegenNode":{"type":13,"tag":"\"div\"","props":{"type":15,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"key","isStatic":true,"constType":3,"loc":{"start":{"column":39,"line":2,"offset":39},"end":{"column":42,"line":2,"offset":42},"source":"key"}},"value":{"type":4,"content":"commit","isStatic":false,"constType":0,"loc":{"start":{"column":44,"line":2,"offset":44},"end":{"column":50,"line":2,"offset":50},"source":"commit"}}}]},"children":[{"type":1,"ns":0,"tag":"span","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}},"arg":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"modifiers":[],"loc":{"start":{"column":11,"line":3,"offset":63},"end":{"column":30,"line":3,"offset":82},"source":":id=\"commit.author\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}}],"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","props":{"type":15,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"value":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}}}]},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_1","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"id\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"}}},{"type":12,"content":{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}},"loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "},"codegenNode":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}}]}},{"type":1,"ns":0,"tag":"span","tagType":0,"props":[],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}}],"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"}}}],"isBlock":true,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"}}}],"codegenNode":{"type":13,"children":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":4,"loc":{"source":"commits","start":{"column":29,"line":2,"offset":29},"end":{"column":36,"line":2,"offset":36}},"content":"commits","isStatic":false,"constType":0},{"type":18,"params":[{"type":4,"loc":{"source":"{ commit }","start":{"column":15,"line":2,"offset":15},"end":{"column":25,"line":2,"offset":25}},"content":"{ commit }","isStatic":false,"constType":0}],"returns":{"type":13,"tag":"\"div\"","props":{"type":15,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"key","isStatic":true,"constType":3,"loc":{"start":{"column":39,"line":2,"offset":39},"end":{"column":42,"line":2,"offset":42},"source":"key"}},"value":{"type":4,"content":"commit","isStatic":false,"constType":0,"loc":{"start":{"column":44,"line":2,"offset":44},"end":{"column":50,"line":2,"offset":50},"source":"commit"}}}]},"children":[{"type":1,"ns":0,"tag":"span","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}},"arg":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"modifiers":[],"loc":{"start":{"column":11,"line":3,"offset":63},"end":{"column":30,"line":3,"offset":82},"source":":id=\"commit.author\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}}],"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","props":{"type":15,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"value":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}}}]},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_1","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"id\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"}}},{"type":12,"content":{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}},"loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "},"codegenNode":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}}]}},{"type":1,"ns":0,"tag":"span","tagType":0,"props":[],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}}],"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"}}}],"isBlock":true,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"}},"newline":true,"isSlot":false,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}}]},"patchFlag":"128 /* KEYED_FRAGMENT */","isBlock":true,"disableTracking":true,"isComponent":false,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"}}},{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":7,"name":"bind","arg":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"style","isStatic":true,"constType":3},"exp":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"{\"color\":\"red\"}","isStatic":false,"constType":3},"modifiers":[],"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"currentBranchPlus","loc":{"start":{"column":29,"line":7,"offset":202},"end":{"column":46,"line":7,"offset":219},"source":"currentBranchPlus"}},"loc":{"start":{"column":27,"line":7,"offset":200},"end":{"column":48,"line":7,"offset":221},"source":"{{currentBranchPlus}}"}}],"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"},"codegenNode":{"type":13,"tag":"\"div\"","props":{"type":4,"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"},"content":"_hoisted_2","isStatic":false,"constType":2,"hoisted":{"type":15,"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"style","isStatic":true,"constType":3},"value":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"{\"color\":\"red\"}","isStatic":false,"constType":3}}]}},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"currentBranchPlus","loc":{"start":{"column":29,"line":7,"offset":202},"end":{"column":46,"line":7,"offset":219},"source":"currentBranchPlus"}},"loc":{"start":{"column":27,"line":7,"offset":200},"end":{"column":48,"line":7,"offset":221},"source":"{{currentBranchPlus}}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"}}},{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":7,"name":"bind","arg":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"style","isStatic":true,"constType":3},"exp":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"{\"color\":\"aquamarine\"}","isStatic":false,"constType":3},"modifiers":[],"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""}},{"type":7,"name":"on","exp":{"type":4,"content":"clickToChangeBranch()","isStatic":false,"constType":0,"loc":{"start":{"column":42,"line":8,"offset":269},"end":{"column":63,"line":8,"offset":290},"source":"clickToChangeBranch()"}},"arg":{"type":4,"content":"click","isStatic":true,"constType":3,"loc":{"start":{"column":35,"line":8,"offset":262},"end":{"column":40,"line":8,"offset":267},"source":"click"}},"modifiers":[],"loc":{"start":{"column":34,"line":8,"offset":261},"end":{"column":64,"line":8,"offset":291},"source":"@click=\"clickToChangeBranch()\""}}],"isSelfClosing":false,"children":[{"type":8,"loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"},"children":[{"type":2,"content":" click me!","loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"}}," + ",{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"reactiveObj.name","loc":{"start":{"column":16,"line":9,"offset":308},"end":{"column":32,"line":9,"offset":324},"source":"reactiveObj.name"}},"loc":{"start":{"column":14,"line":9,"offset":306},"end":{"column":34,"line":9,"offset":326},"source":"{{reactiveObj.name}}"}}]}],"loc":{"start":{"column":3,"line":8,"offset":230},"end":{"column":9,"line":10,"offset":335},"source":"<div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>"},"codegenNode":{"type":13,"tag":"\"div\"","props":{"type":15,"loc":{"start":{"column":3,"line":8,"offset":230},"end":{"column":9,"line":10,"offset":335},"source":"<div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"style","isStatic":true,"constType":3},"value":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"{\"color\":\"aquamarine\"}","isStatic":false,"constType":3}},{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"loc":{"start":{"column":35,"line":8,"offset":262},"end":{"column":40,"line":8,"offset":267},"source":"click"},"content":"onClick","isStatic":true,"constType":3,"isHandlerKey":true},"value":{"type":8,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"children":["$event => (",{"type":4,"content":"clickToChangeBranch()","isStatic":false,"constType":0,"loc":{"start":{"column":42,"line":8,"offset":269},"end":{"column":63,"line":8,"offset":290},"source":"clickToChangeBranch()"}},")"]}}]},"children":{"type":8,"loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"},"children":[{"type":2,"content":" click me!","loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"}}," + ",{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"reactiveObj.name","loc":{"start":{"column":16,"line":9,"offset":308},"end":{"column":32,"line":9,"offset":324},"source":"reactiveObj.name"}},"loc":{"start":{"column":14,"line":9,"offset":306},"end":{"column":34,"line":9,"offset":326},"source":"{{reactiveObj.name}}"}}]},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_3","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"onClick\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":8,"offset":230},"end":{"column":9,"line":10,"offset":335},"source":"<div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>"}}}],"helpers":[null,null,null,null,null,null,null],"components":[],"directives":[],"hoists":[{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"id\"]","isStatic":false,"constType":0},{"type":15,"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"style","isStatic":true,"constType":3},"value":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"{\"color\":\"red\"}","isStatic":false,"constType":3}}]},{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"onClick\"]","isStatic":false,"constType":0}],"imports":[],"cached":0,"temps":0,"codegenNode":{"type":13,"children":[{"type":11,"loc":{"start":{"column":8,"line":2,"offset":8},"end":{"column":37,"line":2,"offset":37},"source":"v-for=\"{ commit } in commits\""},"source":{"type":4,"loc":{"source":"commits","start":{"column":29,"line":2,"offset":29},"end":{"column":36,"line":2,"offset":36}},"content":"commits","isStatic":false,"constType":0},"valueAlias":{"type":4,"loc":{"source":"{ commit }","start":{"column":15,"line":2,"offset":15},"end":{"column":25,"line":2,"offset":25}},"content":"{ commit }","isStatic":false,"constType":0},"parseResult":{"source":{"type":4,"loc":{"source":"commits","start":{"column":29,"line":2,"offset":29},"end":{"column":36,"line":2,"offset":36}},"content":"commits","isStatic":false,"constType":0},"value":{"type":4,"loc":{"source":"{ commit }","start":{"column":15,"line":2,"offset":15},"end":{"column":25,"line":2,"offset":25}},"content":"{ commit }","isStatic":false,"constType":0}},"children":[{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit","isStatic":false,"constType":0,"loc":{"start":{"column":44,"line":2,"offset":44},"end":{"column":50,"line":2,"offset":50},"source":"commit"}},"arg":{"type":4,"content":"key","isStatic":true,"constType":3,"loc":{"start":{"column":39,"line":2,"offset":39},"end":{"column":42,"line":2,"offset":42},"source":"key"}},"modifiers":[],"loc":{"start":{"column":38,"line":2,"offset":38},"end":{"column":51,"line":2,"offset":51},"source":":key=\"commit\""}}],"isSelfClosing":false,"children":[{"type":1,"ns":0,"tag":"span","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}},"arg":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"modifiers":[],"loc":{"start":{"column":11,"line":3,"offset":63},"end":{"column":30,"line":3,"offset":82},"source":":id=\"commit.author\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}}],"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","props":{"type":15,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"value":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}}}]},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_1","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"id\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"}}},{"type":12,"content":{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}},"loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "},"codegenNode":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}}]}},{"type":1,"ns":0,"tag":"span","tagType":0,"props":[],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}}],"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"}}}],"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"},"codegenNode":{"type":13,"tag":"\"div\"","props":{"type":15,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"key","isStatic":true,"constType":3,"loc":{"start":{"column":39,"line":2,"offset":39},"end":{"column":42,"line":2,"offset":42},"source":"key"}},"value":{"type":4,"content":"commit","isStatic":false,"constType":0,"loc":{"start":{"column":44,"line":2,"offset":44},"end":{"column":50,"line":2,"offset":50},"source":"commit"}}}]},"children":[{"type":1,"ns":0,"tag":"span","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}},"arg":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"modifiers":[],"loc":{"start":{"column":11,"line":3,"offset":63},"end":{"column":30,"line":3,"offset":82},"source":":id=\"commit.author\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}}],"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","props":{"type":15,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"value":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}}}]},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_1","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"id\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"}}},{"type":12,"content":{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}},"loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "},"codegenNode":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}}]}},{"type":1,"ns":0,"tag":"span","tagType":0,"props":[],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}}],"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"}}}],"isBlock":true,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"}}}],"codegenNode":{"type":13,"children":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":4,"loc":{"source":"commits","start":{"column":29,"line":2,"offset":29},"end":{"column":36,"line":2,"offset":36}},"content":"commits","isStatic":false,"constType":0},{"type":18,"params":[{"type":4,"loc":{"source":"{ commit }","start":{"column":15,"line":2,"offset":15},"end":{"column":25,"line":2,"offset":25}},"content":"{ commit }","isStatic":false,"constType":0}],"returns":{"type":13,"tag":"\"div\"","props":{"type":15,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"key","isStatic":true,"constType":3,"loc":{"start":{"column":39,"line":2,"offset":39},"end":{"column":42,"line":2,"offset":42},"source":"key"}},"value":{"type":4,"content":"commit","isStatic":false,"constType":0,"loc":{"start":{"column":44,"line":2,"offset":44},"end":{"column":50,"line":2,"offset":50},"source":"commit"}}}]},"children":[{"type":1,"ns":0,"tag":"span","tagType":0,"props":[{"type":7,"name":"bind","exp":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}},"arg":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"modifiers":[],"loc":{"start":{"column":11,"line":3,"offset":63},"end":{"column":30,"line":3,"offset":82},"source":":id=\"commit.author\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}}],"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","props":{"type":15,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"content":"id","isStatic":true,"constType":3,"loc":{"start":{"column":12,"line":3,"offset":64},"end":{"column":14,"line":3,"offset":66},"source":"id"}},"value":{"type":4,"content":"commit.author","isStatic":false,"constType":0,"loc":{"start":{"column":16,"line":3,"offset":68},"end":{"column":29,"line":3,"offset":81},"source":"commit.author"}}}]},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.name","loc":{"start":{"column":34,"line":3,"offset":86},"end":{"column":52,"line":3,"offset":104},"source":"commit.author.name"}},"loc":{"start":{"column":31,"line":3,"offset":83},"end":{"column":55,"line":3,"offset":107},"source":"{{ commit.author.name }}"}},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_1","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"id\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":3,"offset":57},"end":{"column":62,"line":3,"offset":114},"source":"<span :id=\"commit.author\">{{ commit.author.name }}</span>"}}},{"type":12,"content":{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}},"loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "},"codegenNode":{"type":14,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"arguments":[{"type":2,"content":" --- ","loc":{"start":{"column":62,"line":3,"offset":114},"end":{"column":5,"line":5,"offset":127},"source":"\n    ---\n    "}}]}},{"type":1,"ns":0,"tag":"span","tagType":0,"props":[],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}}],"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"},"codegenNode":{"type":13,"tag":"\"span\"","children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"commit.author.date","loc":{"start":{"column":14,"line":5,"offset":136},"end":{"column":32,"line":5,"offset":154},"source":"commit.author.date"}},"loc":{"start":{"column":11,"line":5,"offset":133},"end":{"column":35,"line":5,"offset":157},"source":"{{ commit.author.date }}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":5,"line":5,"offset":127},"end":{"column":42,"line":5,"offset":164},"source":"<span>{{ commit.author.date }}</span>"}}}],"isBlock":true,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"}},"newline":true,"isSlot":false,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}}]},"patchFlag":"128 /* KEYED_FRAGMENT */","isBlock":true,"disableTracking":true,"isComponent":false,"loc":{"start":{"column":3,"line":2,"offset":3},"end":{"column":9,"line":6,"offset":173},"source":"<div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>"}}},{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":7,"name":"bind","arg":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"style","isStatic":true,"constType":3},"exp":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"{\"color\":\"red\"}","isStatic":false,"constType":3},"modifiers":[],"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""}}],"isSelfClosing":false,"children":[{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"currentBranchPlus","loc":{"start":{"column":29,"line":7,"offset":202},"end":{"column":46,"line":7,"offset":219},"source":"currentBranchPlus"}},"loc":{"start":{"column":27,"line":7,"offset":200},"end":{"column":48,"line":7,"offset":221},"source":"{{currentBranchPlus}}"}}],"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"},"codegenNode":{"type":13,"tag":"\"div\"","props":{"type":4,"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"},"content":"_hoisted_2","isStatic":false,"constType":2,"hoisted":{"type":15,"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"style","isStatic":true,"constType":3},"value":{"type":4,"loc":{"start":{"column":8,"line":7,"offset":181},"end":{"column":26,"line":7,"offset":199},"source":"style=\"color: red\""},"content":"{\"color\":\"red\"}","isStatic":false,"constType":3}}]}},"children":{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"currentBranchPlus","loc":{"start":{"column":29,"line":7,"offset":202},"end":{"column":46,"line":7,"offset":219},"source":"currentBranchPlus"}},"loc":{"start":{"column":27,"line":7,"offset":200},"end":{"column":48,"line":7,"offset":221},"source":"{{currentBranchPlus}}"}},"patchFlag":"1 /* TEXT */","isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":7,"offset":176},"end":{"column":54,"line":7,"offset":227},"source":"<div style=\"color: red\">{{currentBranchPlus}}</div>"}}},{"type":1,"ns":0,"tag":"div","tagType":0,"props":[{"type":7,"name":"bind","arg":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"style","isStatic":true,"constType":3},"exp":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"{\"color\":\"aquamarine\"}","isStatic":false,"constType":3},"modifiers":[],"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""}},{"type":7,"name":"on","exp":{"type":4,"content":"clickToChangeBranch()","isStatic":false,"constType":0,"loc":{"start":{"column":42,"line":8,"offset":269},"end":{"column":63,"line":8,"offset":290},"source":"clickToChangeBranch()"}},"arg":{"type":4,"content":"click","isStatic":true,"constType":3,"loc":{"start":{"column":35,"line":8,"offset":262},"end":{"column":40,"line":8,"offset":267},"source":"click"}},"modifiers":[],"loc":{"start":{"column":34,"line":8,"offset":261},"end":{"column":64,"line":8,"offset":291},"source":"@click=\"clickToChangeBranch()\""}}],"isSelfClosing":false,"children":[{"type":8,"loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"},"children":[{"type":2,"content":" click me!","loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"}}," + ",{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"reactiveObj.name","loc":{"start":{"column":16,"line":9,"offset":308},"end":{"column":32,"line":9,"offset":324},"source":"reactiveObj.name"}},"loc":{"start":{"column":14,"line":9,"offset":306},"end":{"column":34,"line":9,"offset":326},"source":"{{reactiveObj.name}}"}}]}],"loc":{"start":{"column":3,"line":8,"offset":230},"end":{"column":9,"line":10,"offset":335},"source":"<div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>"},"codegenNode":{"type":13,"tag":"\"div\"","props":{"type":15,"loc":{"start":{"column":3,"line":8,"offset":230},"end":{"column":9,"line":10,"offset":335},"source":"<div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>"},"properties":[{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"style","isStatic":true,"constType":3},"value":{"type":4,"loc":{"start":{"column":8,"line":8,"offset":235},"end":{"column":33,"line":8,"offset":260},"source":"style=\"color: aquamarine\""},"content":"{\"color\":\"aquamarine\"}","isStatic":false,"constType":3}},{"type":16,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"key":{"type":4,"loc":{"start":{"column":35,"line":8,"offset":262},"end":{"column":40,"line":8,"offset":267},"source":"click"},"content":"onClick","isStatic":true,"constType":3,"isHandlerKey":true},"value":{"type":8,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"children":["$event => (",{"type":4,"content":"clickToChangeBranch()","isStatic":false,"constType":0,"loc":{"start":{"column":42,"line":8,"offset":269},"end":{"column":63,"line":8,"offset":290},"source":"clickToChangeBranch()"}},")"]}}]},"children":{"type":8,"loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"},"children":[{"type":2,"content":" click me!","loc":{"start":{"column":65,"line":8,"offset":292},"end":{"column":14,"line":9,"offset":306},"source":"\n    click me!"}}," + ",{"type":5,"content":{"type":4,"isStatic":false,"constType":0,"content":"reactiveObj.name","loc":{"start":{"column":16,"line":9,"offset":308},"end":{"column":32,"line":9,"offset":324},"source":"reactiveObj.name"}},"loc":{"start":{"column":14,"line":9,"offset":306},"end":{"column":34,"line":9,"offset":326},"source":"{{reactiveObj.name}}"}}]},"patchFlag":"9 /* TEXT, PROPS */","dynamicProps":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"_hoisted_3","isStatic":false,"constType":2,"hoisted":{"type":4,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}},"content":"[\"onClick\"]","isStatic":false,"constType":0}},"isBlock":false,"disableTracking":false,"isComponent":false,"loc":{"start":{"column":3,"line":8,"offset":230},"end":{"column":9,"line":10,"offset":335},"source":"<div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>"}}}],"patchFlag":"64 /* STABLE_FRAGMENT */","isBlock":true,"disableTracking":false,"isComponent":false,"loc":{"source":"","start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}},"loc":{"start":{"column":1,"line":1,"offset":0},"end":{"column":1,"line":11,"offset":336},"source":"\n  <div v-for=\"{ commit } in commits\" :key=\"commit\">\n    <span :id=\"commit.author\">{{ commit.author.name }}</span>\n    ---\n    <span>{{ commit.author.date }}</span>\n  </div>\n  <div style=\"color: red\">{{currentBranchPlus}}</div>\n  <div style=\"color: aquamarine\" @click=\"clickToChangeBranch()\">\n    click me!{{reactiveObj.name}}\n  </div>\n"}}
```

- ç¬¬ä¸‰æ­¥`generate`ç”Ÿæˆä»£ç ä¸²

```ts
const _Vue = Vue
const { createElementVNode: _createElementVNode, createTextVNode: _createTextVNode } = _Vue

const _hoisted_1 = ["id"]
const _hoisted_2 = { style: {"color":"red"} }
const _hoisted_3 = ["onClick"]

return function render(_ctx, _cache) {
  with (_ctx) {
    const { renderList: _renderList, Fragment: _Fragment, openBlock: _openBlock, createElementBlock: _createElementBlock, toDisplayString: _toDisplayString, createElementVNode: _createElementVNode, createTextVNode: _createTextVNode } = _Vue

    return (_openBlock(), _createElementBlock(_Fragment, null, [
      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(commits, ({ commit }) => {
        return (_openBlock(), _createElementBlock("div", { key: commit }, [
          _createElementVNode("span", { id: commit.author }, _toDisplayString(commit.author.name), 9 /* TEXT, PROPS */, _hoisted_1),
          _createTextVNode(" --- "),
          _createElementVNode("span", null, _toDisplayString(commit.author.date), 1 /* TEXT */)
        ]))
      }), 128 /* KEYED_FRAGMENT */)),
      _createElementVNode("div", _hoisted_2, _toDisplayString(currentBranchPlus), 1 /* TEXT */),
      _createElementVNode("div", {
        style: {"color":"aquamarine"},
        onClick: $event => (clickToChangeBranch())
      }, " click me!" + _toDisplayString(reactiveObj.name), 9 /* TEXT, PROPS */, _hoisted_3)
    ], 64 /* STABLE_FRAGMENT */))
  }
}
```

![compile](./assets/vue3çš„ç¼–è¯‘.png)
