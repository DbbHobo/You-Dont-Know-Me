# 闭包

## 作用域

- 执行环境

执行环境定义了变量或函数有权访问的其他数据，决定了它们各自的行为。每个执行环境都有一个与之关联的变量对象（variable object） ，环境中定义的所有变量和函数都保存在这个对象中。

- 全局作用域

全局执行环境是最外围的一个执行环境。根据 ECMAScript 实现所在的宿主环境不同，表示执行环境的对象也不一样。在 Web 环境是 window，在 Node 环境是 global。

- 函数作用域

每个函数都有自己的执行环境。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。而在函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。

- 块级作用域

1. 函数是 JavaScript 中最常见的作用域单元。 
2. `let` 为 JavaScript 新增了块级作用域。`let` 命令、`const` 命令、`class` 命令声明的全局变量，不属于顶层对象的属性。
3. `try/catch` 结构在 `catch` 分句中具有块作用域。

- 作用域链

当代码在一个环境中执行时，会创建变量对象的一个作用域链。内部环境可以通过作用域链访问所有的外部环境，但外部环境不能访问内部环境中的任何变量和函数。作用域链本质上是一个指向变量对象的指针列表，它只引用但不实际包含变量对象。

## 闭包

函数 A 内部有一个函数 B，函数 B 可以访问到函数 A 中的变量，那么函数 B 就是闭包。

- 作用

可以隔离作用域，不造成全局污染，使用闭包来模拟私有方法

- 问题

内存泄漏（Memory Leak)

闭包阻止了垃圾回收机制对变量进行回收，因此变量会永远存在内存中，即使当变量不再被使用时，这样会造成内存泄漏，会严重影响页面的性能。因此当变量对象不再适用时，我们要将其释放。解决内存泄露：将暴露外部的闭包变量置为 null。

性能考量

如果不是某些特定任务需要使用闭包，在其它函数中创建函数是不明智的，因为闭包在处理速度和内存消耗方面对脚本性能具有负面影响。

- 适用场景

封装组件，for 循环和定时器结合使用,for 循环和 dom 事件结合。可以在性能优化的过程中,通过节流、防抖函数的使用优化，模块化与柯里化。

参考资料

[Closures MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures)
